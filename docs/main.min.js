(function() {
const buttonsColors = document.querySelectorAll('.colors__item-title');
const listColors = document.querySelector('.colors__list');
const closeColors = document.querySelector('.colors__item-close');

document.addEventListener('click', e => {
 for( let btn of buttonsColors) {
     if (btn.parentNode.classList.contains('colors__item--active') && e.target !== btn ) {
       btn.parentNode.classList.remove('colors__item--active')
     }
 }  

  for( let btn of buttonsColors) {
    if (e.target === btn) {
     btn.parentNode.classList.toggle('colors__item--active'); 
   }
  }
  
    if (e.target === closeColors) {
     btn.parentNode.classList.toggle('colors__item--active'); 
   }
});
}) ();

(function() {
const buttons = document.querySelectorAll('.team__name');
const list = document.querySelector('.team__list');
document.addEventListener('click', e => {
 for( let btn of buttons) {
     if (btn.parentNode.classList.contains('team__item--active') && e.target !== btn ) {
       btn.parentNode.classList.remove('team__item--active')
     }
 }  

  for( let btn of buttons) {
    if (e.target === btn) {
     btn.parentNode.classList.toggle('team__item--active'); 
   }
  }
});
}) ();

// const myForm = document.querySelector('#myForm');
// const send = document.querySelector('#send');

// send.addEventListener('click', event => {
//     event.preventDefault();

//     if (validateForm(myForm)) {
//         const data = {
//             name: myForm.elements.name.value,
//             phone: myForm.elements.phone.value,
//             email: myForm.elements.email.value,
//             comment: myForm.elements.comment.value,
//         };


//         const xhr = new XMLHttpRequest();
//         xhr.responseType = 'json';
//         xhr.open('POST', 'https://webdev-api.loftschool.com/sendmail');
//         xhr.setRequestHeader('content-type', 'application/json');
//         xhr.send(JSON.stringify(data));
//         xhr.addEventListener('load', () => {
//            if (xhr.response.status) {                    
//                console.log('ok');
//            }
//         });
//     }
// });

// function validateForm(form){
//     let valid = true;

//     if (!validateField(form.elements.name)) {
//         valid = false;
//     };    
//     if (!validateField(form.elements.phone)) {
//         valid = false;
//     };
//     if (!validateField(form.elements.email)) {
//         valid = false;
//     };
//     if (!validateField(form.elements.comment)) {
//         valid = false;
//     };

//     return valid;
// }

// function validateField(field) {
//     field.nextElementSibling.textContent = field.validationMessage;
//     return field.checkValidity();
// }
(function() {
let burger  = document.querySelector('.burger');
let overlay = document.querySelector('.burger-menu');
let closer = document.querySelector('.burger-menu__closer');

let links = document.querySelectorAll('.burger-menu__link');

links.forEach(function(element){
  element.addEventListener('click' , toggleMenu);
})

function toggleMenu(){
  burger.classList.toggle('burger--active');
  overlay.classList.toggle('burger-menu--active');
  closer.classList.toggle('closer');
}

burger.addEventListener('click' , toggleMenu);
}) ();
(function() {
/* ===========================================================
 * jquery-onepage-scroll.js v1.3.1
 * ===========================================================
 * Copyright 2013 Pete Rojwongsuriya.
 * http://www.thepetedesign.com
 *
 * Create an Apple-like website that let user scroll
 * one page at a time
 *
 * Credit: Eike Send for the awesome swipe event
 * https://github.com/peachananr/onepage-scroll
 *
 * License: GPL v3
 *
 * ========================================================== */

!function($){

  var defaults = {
    sectionContainer: "section",
    easing: "ease",
    animationTime: 1000,
    pagination: true,
    updateURL: false,
    keyboard: true,
    beforeMove: null,
    afterMove: null,
    loop: true,
    responsiveFallback: false,
    direction : 'vertical'
	};

	/*------------------------------------------------*/
	/*  Credit: Eike Send for the awesome swipe event */
	/*------------------------------------------------*/

	$.fn.swipeEvents = function() {
      return this.each(function() {

        var startX,
            startY,
            $this = $(this);

        $this.bind('touchstart', touchstart);

        function touchstart(event) {
          var touches = event.originalEvent.touches;
          if (touches && touches.length) {
            startX = touches[0].pageX;
            startY = touches[0].pageY;
            $this.bind('touchmove', touchmove);
          }
        }

        function touchmove(event) {
          var touches = event.originalEvent.touches;
          if (touches && touches.length) {
            var deltaX = startX - touches[0].pageX;
            var deltaY = startY - touches[0].pageY;

            if (deltaX >= 50) {
              $this.trigger("swipeLeft");
            }
            if (deltaX <= -50) {
              $this.trigger("swipeRight");
            }
            if (deltaY >= 50) {
              $this.trigger("swipeUp");
            }
            if (deltaY <= -50) {
              $this.trigger("swipeDown");
            }
            if (Math.abs(deltaX) >= 50 || Math.abs(deltaY) >= 50) {
              $this.unbind('touchmove', touchmove);
            }
          }
        }

      });
    };


  $.fn.onepage_scroll = function(options){
    var settings = $.extend({}, defaults, options),
        el = $(this),
        sections = $(settings.sectionContainer),
        total = sections.length,
        status = "off",
        topPos = 0,
        leftPos = 0,
        lastAnimation = 0,
        quietPeriod = 500,
        paginationList = "";

    $.fn.transformPage = function(settings, pos, index) {
      if (typeof settings.beforeMove == 'function') settings.beforeMove(index);

      // Just a simple edit that makes use of modernizr to detect an IE8 browser and changes the transform method into
    	// an top animate so IE8 users can also use this script.
    	if($('html').hasClass('ie8')){
        if (settings.direction == 'horizontal') {
          var toppos = (el.width()/100)*pos;
          $(this).animate({left: toppos+'px'},settings.animationTime);
        } else {
          var toppos = (el.height()/100)*pos;
          $(this).animate({top: toppos+'px'},settings.animationTime);
        }
    	} else{
    	  $(this).css({
    	    "-webkit-transform": ( settings.direction == 'horizontal' ) ? "translate3d(" + pos + "%, 0, 0)" : "translate3d(0, " + pos + "%, 0)",
         "-webkit-transition": "all " + settings.animationTime + "ms " + settings.easing,
         "-moz-transform": ( settings.direction == 'horizontal' ) ? "translate3d(" + pos + "%, 0, 0)" : "translate3d(0, " + pos + "%, 0)",
         "-moz-transition": "all " + settings.animationTime + "ms " + settings.easing,
         "-ms-transform": ( settings.direction == 'horizontal' ) ? "translate3d(" + pos + "%, 0, 0)" : "translate3d(0, " + pos + "%, 0)",
         "-ms-transition": "all " + settings.animationTime + "ms " + settings.easing,
         "transform": ( settings.direction == 'horizontal' ) ? "translate3d(" + pos + "%, 0, 0)" : "translate3d(0, " + pos + "%, 0)",
         "transition": "all " + settings.animationTime + "ms " + settings.easing
    	  });
    	}
      $(this).one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function(e) {
        if (typeof settings.afterMove == 'function') settings.afterMove(index);
      });
    }

    $.fn.moveDown = function() {
      var el = $(this)
      index = $(settings.sectionContainer +".active").data("index");
      current = $(settings.sectionContainer + "[data-index='" + index + "']");
      next = $(settings.sectionContainer + "[data-index='" + (index + 1) + "']");
      if(next.length < 1) {
        if (settings.loop == true) {
          pos = 0;
          next = $(settings.sectionContainer + "[data-index='1']");
        } else {
          return
        }

      }else {
        pos = (index * 100) * -1;
      }
      if (typeof settings.beforeMove == 'function') settings.beforeMove( next.data("index"));
      current.removeClass("active")
      next.addClass("active");
      if(settings.pagination == true) {
        $(".onepage-pagination li a" + "[data-index='" + index + "']").removeClass("active");
        $(".onepage-pagination li a" + "[data-index='" + next.data("index") + "']").addClass("active");
      }

      $("body")[0].className = $("body")[0].className.replace(/\bviewing-page-\d.*?\b/g, '');
      $("body").addClass("viewing-page-"+next.data("index"))

      if (history.replaceState && settings.updateURL == true) {
        var href = window.location.href.substr(0,window.location.href.indexOf('#')) + "#" + (index + 1);
        history.pushState( {}, document.title, href );
      }
      el.transformPage(settings, pos, next.data("index"));
    }

    $.fn.moveUp = function() {
      var el = $(this)
      index = $(settings.sectionContainer +".active").data("index");
      current = $(settings.sectionContainer + "[data-index='" + index + "']");
      next = $(settings.sectionContainer + "[data-index='" + (index - 1) + "']");

      if(next.length < 1) {
        if (settings.loop == true) {
          pos = ((total - 1) * 100) * -1;
          next = $(settings.sectionContainer + "[data-index='"+total+"']");
        }
        else {
          return
        }
      }else {
        pos = ((next.data("index") - 1) * 100) * -1;
      }
      if (typeof settings.beforeMove == 'function') settings.beforeMove(next.data("index"));
      current.removeClass("active")
      next.addClass("active")
      if(settings.pagination == true) {
        $(".onepage-pagination li a" + "[data-index='" + index + "']").removeClass("active");
        $(".onepage-pagination li a" + "[data-index='" + next.data("index") + "']").addClass("active");
      }
      $("body")[0].className = $("body")[0].className.replace(/\bviewing-page-\d.*?\b/g, '');
      $("body").addClass("viewing-page-"+next.data("index"))

      if (history.replaceState && settings.updateURL == true) {
        var href = window.location.href.substr(0,window.location.href.indexOf('#')) + "#" + (index - 1);
        history.pushState( {}, document.title, href );
      }
      el.transformPage(settings, pos, next.data("index"));
    }

    $.fn.moveTo = function(page_index) {
      current = $(settings.sectionContainer + ".active")
      next = $(settings.sectionContainer + "[data-index='" + (page_index) + "']");
      if(next.length > 0) {
        if (typeof settings.beforeMove == 'function') settings.beforeMove(next.data("index"));
        current.removeClass("active")
        next.addClass("active")
        $(".onepage-pagination li a" + ".active").removeClass("active");
        $(".onepage-pagination li a" + "[data-index='" + (page_index) + "']").addClass("active");
        $("body")[0].className = $("body")[0].className.replace(/\bviewing-page-\d.*?\b/g, '');
        $("body").addClass("viewing-page-"+next.data("index"))

        pos = ((page_index - 1) * 100) * -1;

        if (history.replaceState && settings.updateURL == true) {
            var href = window.location.href.substr(0,window.location.href.indexOf('#')) + "#" + (page_index - 1);
            history.pushState( {}, document.title, href );
        }
        el.transformPage(settings, pos, page_index);
      }
    }

    function responsive() {
      //start modification
      var valForTest = false;
      var typeOfRF = typeof settings.responsiveFallback

      if(typeOfRF == "number"){
      	valForTest = $(window).width() < settings.responsiveFallback;
      }
      if(typeOfRF == "boolean"){
      	valForTest = settings.responsiveFallback;
      }
      if(typeOfRF == "function"){
      	valFunction = settings.responsiveFallback();
      	valForTest = valFunction;
      	typeOFv = typeof valForTest;
      	if(typeOFv == "number"){
      		valForTest = $(window).width() < valFunction;
      	}
      }

      //end modification
      if (valForTest) {
        $("body").addClass("disabled-onepage-scroll");
        $(document).unbind('mousewheel DOMMouseScroll MozMousePixelScroll');
        el.swipeEvents().unbind("swipeDown swipeUp");
      } else {
        if($("body").hasClass("disabled-onepage-scroll")) {
          $("body").removeClass("disabled-onepage-scroll");
          $("html, body, .wrapper").animate({ scrollTop: 0 }, "fast");
        }


        el.swipeEvents().bind("swipeDown",  function(event){
          if (!$("body").hasClass("disabled-onepage-scroll")) event.preventDefault();
          el.moveUp();
        }).bind("swipeUp", function(event){
          if (!$("body").hasClass("disabled-onepage-scroll")) event.preventDefault();
          el.moveDown();
        });

        $(document).bind('mousewheel DOMMouseScroll MozMousePixelScroll', function(event) {
          event.preventDefault();
          var delta = event.originalEvent.wheelDelta || -event.originalEvent.detail;
          init_scroll(event, delta);
        });
      }
    }


    function init_scroll(event, delta) {
        deltaOfInterest = delta;
        var timeNow = new Date().getTime();
        // Cancel scroll if currently animating or within quiet period
        if(timeNow - lastAnimation < quietPeriod + settings.animationTime) {
            event.preventDefault();
            return;
        }

        if (deltaOfInterest < 0) {
          el.moveDown()
        } else {
          el.moveUp()
        }
        lastAnimation = timeNow;
    }

    // Prepare everything before binding wheel scroll

    el.addClass("onepage-wrapper").css("position","relative");
    $.each( sections, function(i) {
      $(this).css({
        position: "absolute",
        top: topPos + "%"
      }).addClass("section").attr("data-index", i+1);


      $(this).css({
        position: "absolute",
        left: ( settings.direction == 'horizontal' )
          ? leftPos + "%"
          : 0,
        top: ( settings.direction == 'vertical' || settings.direction != 'horizontal' )
          ? topPos + "%"
          : 0
      });

      if (settings.direction == 'horizontal')
        leftPos = leftPos + 100;
      else
        topPos = topPos + 100;


      if(settings.pagination == true) {
        paginationList += "<li><a data-index='"+(i+1)+"' href='#" + (i+1) + "'></a></li>"
      }
    });

    el.swipeEvents().bind("swipeDown",  function(event){
      if (!$("body").hasClass("disabled-onepage-scroll")) event.preventDefault();
      el.moveUp();
    }).bind("swipeUp", function(event){
      if (!$("body").hasClass("disabled-onepage-scroll")) event.preventDefault();
      el.moveDown();
    });

    // Create Pagination and Display Them
    if (settings.pagination == true) {
      if ($('ul.onepage-pagination').length < 1) $("<ul class='onepage-pagination'></ul>").prependTo("body");

      if( settings.direction == 'horizontal' ) {
        posLeft = (el.find(".onepage-pagination").width() / 2) * -1;
        el.find(".onepage-pagination").css("margin-left", posLeft);
      } else {
        posTop = (el.find(".onepage-pagination").height() / 2) * -1;
        el.find(".onepage-pagination").css("margin-top", posTop);
      }
      $('ul.onepage-pagination').html(paginationList);
    }

    if(window.location.hash != "" && window.location.hash != "#1") {
      init_index =  window.location.hash.replace("#", "")

      if (parseInt(init_index) <= total && parseInt(init_index) > 0) {
        $(settings.sectionContainer + "[data-index='" + init_index + "']").addClass("active")
        $("body").addClass("viewing-page-"+ init_index)
        if(settings.pagination == true) $(".onepage-pagination li a" + "[data-index='" + init_index + "']").addClass("active");

        next = $(settings.sectionContainer + "[data-index='" + (init_index) + "']");
        if(next) {
          next.addClass("active")
          if(settings.pagination == true) $(".onepage-pagination li a" + "[data-index='" + (init_index) + "']").addClass("active");
          $("body")[0].className = $("body")[0].className.replace(/\bviewing-page-\d.*?\b/g, '');
          $("body").addClass("viewing-page-"+next.data("index"))
          if (history.replaceState && settings.updateURL == true) {
            var href = window.location.href.substr(0,window.location.href.indexOf('#')) + "#" + (init_index);
            history.pushState( {}, document.title, href );
          }
        }
        pos = ((init_index - 1) * 100) * -1;
        el.transformPage(settings, pos, init_index);
      } else {
        $(settings.sectionContainer + "[data-index='1']").addClass("active")
        $("body").addClass("viewing-page-1")
        if(settings.pagination == true) $(".onepage-pagination li a" + "[data-index='1']").addClass("active");
      }
    }else{
      $(settings.sectionContainer + "[data-index='1']").addClass("active")
      $("body").addClass("viewing-page-1")
      if(settings.pagination == true) $(".onepage-pagination li a" + "[data-index='1']").addClass("active");
    }

    if(settings.pagination == true)  {
      $(".onepage-pagination li a").click(function (){
        var page_index = $(this).data("index");
        el.moveTo(page_index);
      });
    }


    $(document).bind('mousewheel DOMMouseScroll MozMousePixelScroll', function(event) {
      event.preventDefault();
      var delta = event.originalEvent.wheelDelta || -event.originalEvent.detail;
      if(!$("body").hasClass("disabled-onepage-scroll")) init_scroll(event, delta);
    });


    if(settings.responsiveFallback != false) {
      $(window).resize(function() {
        responsive();
      });

      responsive();
    }

    if(settings.keyboard == true) {
      $(document).keydown(function(e) {
        var tag = e.target.tagName.toLowerCase();

        if (!$("body").hasClass("disabled-onepage-scroll")) {
          switch(e.which) {
            case 38:
              if (tag != 'input' && tag != 'textarea') el.moveUp()
            break;
            case 40:
              if (tag != 'input' && tag != 'textarea') el.moveDown()
            break;
            case 32: //spacebar
              if (tag != 'input' && tag != 'textarea') el.moveDown()
            break;
            case 33: //pageg up
              if (tag != 'input' && tag != 'textarea') el.moveUp()
            break;
            case 34: //page dwn
              if (tag != 'input' && tag != 'textarea') el.moveDown()
            break;
            case 36: //home
              el.moveTo(1);
            break;
            case 35: //end
              el.moveTo(total);
            break;
            default: return;
          }
        }

      });
    }
    return false;
  }


}(window.jQuery);


$(".main").onepage_scroll();
}) ();
(function() {
let myMap;

const init = () => {                                            // центр карты, настройки зума, отключить все кнопки
    myMap = new ymaps.Map('map', {
        center: [55.160028, 61.402590],
        zoom: 13,
        controls: []
    });

    const coords = [                                              // координаты собственных точек
        [55.152320, 61.388858],
        [55.169214, 61.387146],
        [55.163565, 61.414419],
        [55.176060, 61.397218]
    ];

    const myCollection = new ymaps.GeoObjectCollection({}, {      // настройки иконок коллекции
        draggable: false,
        iconLayout: 'default#image',
        iconImageHref: './images/symbol/marker.svg',
        iconImageSize: [58, 74],
        iconImageOffset: [0, 0]
    });

    coords.forEach(coord => {
        myCollection.add(new ymaps.Placemark(coord));             // перебрали и добавили координаты для своих точек
    });

    myMap.geoObjects.add(myCollection);                           // добавили свою коллекцию

    myMap.behaviors.disable('scrollZoom');                        // отключен зум колёсиком
}

ymaps.ready(init);
}) ();
(function() {
const validateFields = (form, fieldsArray) => {
  fieldsArray.forEach((field) => {
    field.removeClass("input-error");
    if (field.val() === "") {
      field.addClass("input-error");
    }
  });

  const errorFields = form.find(".input-error");

  return errorFields.length === 0;
};

$(".order__form").submit((e) => {
  e.preventDefault();

  const form = $(e.currentTarget);
  const name = form.find("[name='name']");
  const phone = form.find("[name='phone']");
  const comment = form.find("[name='comment']");
  const to = form.find("[name='to']");

  const modal = $("#modal");
  const content = modal.find(".modal__content");

  modal.removeClass("error-modal");

  const isValid = validateFields(form, [name, phone, comment, to]);

  if (isValid) {
    const request = $.ajax({
      url: "https://webdev-api.loftschool.com/sendmail",
      method: "post",
      data: {
        name: name.val(),
        phone: phone.val(),
        comment: comment.val(),
        to: to.val(),
      },
      error: (data) => {},
    });

    request.done((data) => {
      content.text(data.message);
    });

    request.fail((data) => {
      const message = data.responseJSON.message;
      content.text(message);
      modal.addClass("error-modal");
    });

    request.always(() => {
      $.fancybox.open({
        src: "#modal",
        type: "inline",
      });
    });
  }
});

$(".js-close-modal").click((e) => {
  e.preventDefault();
  console.log('klik');
  const form = $('.order__form');
  const name = form.find("[name='name']");
  const phone = form.find("[name='phone']");
  const comment = form.find("[name='comment']")

  comment.val('');
  name.val("")
  phone.val("")
  
  $.fancybox.close();
});
}) ();

// // function submitForm (oFormElement) {
// //     var xhr = new XMLHttpRequest();
// //     xhr.onload = function() {
// //         alert (xhr.responseText); 
// //     }
// //     xhr.open (oFormElement.method, oFormElement.action, true);
// //     xhr.send (new FormData (oFormElement));
// //     return false;
// // }

// // xhr.onreadystatechange = function() {
// //   if (this.readyState == 4 && this.status == 200) {
// //     var data = JSON.parse(this.responseText);
// //     console.log(data);
// //   }
// // };


// $(document).ready(() => {

//     $('.button').on('click', e => {

//         let block = $('.type__form:last-child');

//         let value = block.val();         // получить то, что вводят в текстовое поле 

//         console.log(value);

//         // let block = $('.radio:checked');
//         // let block = $('#select');
//         // let block = $('#file');         // имя файла с приставкой fakepath
//     })
// })
(function() {
// let player;
// const playerContainer = $('.player');


// let eventsInit = () => {
//     $('.player__start').click(e => {
//         e.preventDefault();

//         if (playerContainer.hasClass('paused')) {
//             player.pause();                              // по клику старт, если видео было на паузе
//         } else {
//             player.play();                               // по клику пауза, если видео проигрывалось
//         }
//     });

//     $('.player__playback').click(e => {                        // по клику на прокрутку перематываем видос
//         const bar = $(e.currentTarget);

//         const clickedPosition = e.originalEvent.layerX;
//         const newButtonPositionPercent = (clickedPosition / bar.width()) * 100;
//         const newPlaybackPositionSec = (player.getDuration() / 100) * newButtonPositionPercent;

//         $('.player__playback-button').css({
//             left: `${newButtonPositionPercent}%`
//         });

//         player.seekTo(newPlaybackPositionSec);
//     })
    
//     $('.player__volume').click(e => {
//         const volBar = $(e.currentTarget);

//         const clickedVol = e.originalEvent.layerX;
//         const newButtonPositionVolPercent = (clickedVol / volBar.width()) * 100;
//         const newVolPosition = clickedVol / volBar.width();

        
//         $('.player__volume-button').css({
//             left: `${newButtonPositionVolPercent}%`
//         });

//         player.volume(newVolPosition);      
//     });
    
//     $('.player__splash').click(e => {
//         player.play();
//     })

// };

// const formatTime = timeSec => {
//     const roundTime = Math.round(timeSec);

//     const minutes = addZero(Math.floor(roundTime / 60));
//     const seconds = addZero(roundTime - minutes * 60);

//     function addZero(num) {                                   // функция, чтобы на видосах короче 10 минут в начале был нолик
//         return num < 10 ? `0${num}`:num;
//     }

//     return `${minutes}:${seconds}`;                         // время возвращается в обычном формате
// };  

// const onPlayerReady = () => {
//     let interval;
//     const durationSec = player.getDuration();

//     $('.player__duration-estimate').text(formatTime(durationSec));

//     if (typeof interval != 'undefined') {
//         clearInterval(interval);
//     }

//     interval = setInterval(() => {
//         const completedSec = player.getCurrentTime();
//         const completedPercent = (completedSec / durationSec) * 100;

//         $('.player__playback-button').css({                     // полоска прокрутки двигается параллельно текущей точке видео
//             left: `${completedPercent}%` 
//         });

//         $('.player__duration-completed').text(formatTime(completedSec));
//     }, 1000);                                                   //  сколько секунд видоса прошло - столько и отобразилось
// };

// const onPlayerStateChange = event => {

//     // -1 (воспроизведение видео не начато)
//     // 0 (воспроизведение видео завершено)
//     // 1 (воспроизведение)
//     // 2 (пауза)
//     // 3 (буферизация)
//     // 5 (видео подают реплики).

//     switch (event.data) {
//         case 1:
//             playerContainer.addClass('active');
//             playerContainer.addClass('paused');
//             break;

//         case 2:
//             playerContainer.removeClass('active');
//             playerContainer.removeClass('paused');
//             break;
//     }
// }

// function onYouTubeIframeAPIReady() {
//     player = new YT.Player('yt-player', {
//         height: '405',
//         width: '660',
//         videoId: 'M7lc1UVf-VE',
//         events: {
//         'onReady': onPlayerReady,
//         'onStateChange': onPlayerStateChange
//         },
//         playerVars: {                                           // убираем стандартные элементы интерфейса, которые сделаем сами
//             controls: 0,
//             disablekb: 0,
//             showinfo: 0,
//             rel: 0,
//             autoplay: 0,
//             modestbranding: 0
//         }
//     });
// }

// eventsInit();


/// О господи, это же HTML5 решение!!!!111

const playerContainer = document.querySelector('.player');
const playerWrapper = document.querySelector('.player__content');
const video = document.querySelector('#myvideo');
const playerStart = document.querySelector('.player__start');
const playerPlayback = document.querySelector('.player__playback');
const progressBar = document.querySelector('.player__playback-line');
const playerVideoCircle = document.querySelector('.player__playback-button');
const playerVolumeIcon = document.querySelector('.player__volume-svg');
const playerVolumeBar = document.querySelector('.player__volume');
const playerVolumeCirlce = document.querySelector('.player__volume-button');
let startVolume = 0;
let currentVolume;

/// запуск

const handleStart = () => {
    video.paused ? video.play() : video.pause();
    // if(video.paused) {
    //     video.play();
    // } else {
    //     video.pause();
    // }
}

playerStart.addEventListener('click', handleStart);
playerWrapper.addEventListener('click', handleStart);


/// play/pause

video.onplay = () => {
    togglePlayer();
}

video.onpause = () => {
    togglePlayer('pause');
}

const togglePlayer = ( action = 'start') => {
    action === 'start' ? playerContainer.classList.add('player_active') : playerContainer.classList.remove('player_active');
}


/// изменение звука 

const changeVolume = (e) => {
    // const {currentTarget} = e;
    const currentTarget = e.currentTarget;
    const left = currentTarget.getBoundingClientRect().left;
    const soundBarWidth = parseInt(getComputedStyle(currentTarget).width);
    const newPosition = e.pageX - left;
    const percentValue = (newPosition / soundBarWidth) * 100;
    if (percentValue < 100) {
        video.volume = percentValue / 100;
        playerVolumeCirlce.style.left = `${percentValue}%`;
    }
}


const toggleSound = () => {
    playerVolumeIcon.classList.toggle('muted');

    if(video.volume === 0) {
    video.volume = currentVolume;
    playerVolumeCirlce.style.left = `${currentVolume * 100}%`;
    } else {
        currentVolume = video.volume;
        video.volume = startVolume;
        playerVolumeCirlce.style.left = `${startVolume}%`;
    }

    // muted video

    /// unmuted video
    
    
}

playerVolumeBar.addEventListener('click', changeVolume);
playerVolumeIcon.addEventListener('click', toggleSound);

const handleDuration = (e) => {
    const barSize = parseInt(getComputedStyle(playerPlayback).width);
    const cirlceWidth = parseInt(getComputedStyle(playerVideoCircle).width);
    // const {offsetX} = e;
    const offsetX = e.offsetX;
    const newSize = offsetX + cirlceWidth / 2;
    const newTime = (newSize * video.duration) / barSize;
    video.currentTime = newTime;
}

const updateTime = () => {
    let orangeBar = video.currentTime / video.duration;
    progressBar.style.width = `${orangeBar * 100}%`;

    if (video.ended) {
        video.currentTime = 0;
    }
}

playerPlayback.addEventListener('click', handleDuration);
video.addEventListener('timeupdate', updateTime);
}) ();
(function() {
const slider = $('.slider__list').bxSlider({
    pager: false,
    controls: false,
    speed: 750,
    easing: 'ease-in-out'
});

$('.slider__arrow--left').click(e => {
    e.preventDefault();
    slider.goToPrevSlide();
})

$('.slider__arrow--right').click(e => {
    e.preventDefault();
    slider.goToNextSlide()
});
}) ();
(function() {
const findBlockByAlias = (alias) => {
    return $('.review__item').filter((ndx, item) => {
        return $(item).attr('data-linked-with') == alias;
    });
}
$('.interactive-avatar__link').click(e => {
    e.preventDefault();
    
    const $this = $(e.currentTarget);
    const target = $this.attr('data-open');
    const itemToShow = findBlockByAlias(target);
    const curItem = $this.closest('.reviewers__item');

    itemToShow.addClass('active').siblings().removeClass('active');
    curItem.addClass("reviewers__item--active").siblings().removeClass('reviewers__item--active');
})
}) ();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY29yZGlvbi1ob3Jpem9udGFsLmpzIiwiYWNjb3JkaW9uLXZlcnRpY2FsLmpzIiwiYWpheC5qcyIsImJ1cmdlci5qcyIsImpxdWVyeS5vbmVwYWdlLXNjcm9sbC5qcyIsIm1hcC5qcyIsIm1vZGFsLmpzIiwib3JkZXItZm9ybS5qcyIsInBsYXllci5qcyIsInNsaWRlci5qcyIsInNsaWRlc2hvdy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcclxuY29uc3QgYnV0dG9uc0NvbG9ycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb2xvcnNfX2l0ZW0tdGl0bGUnKTtcclxuY29uc3QgbGlzdENvbG9ycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb2xvcnNfX2xpc3QnKTtcclxuY29uc3QgY2xvc2VDb2xvcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29sb3JzX19pdGVtLWNsb3NlJyk7XHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG4gZm9yKCBsZXQgYnRuIG9mIGJ1dHRvbnNDb2xvcnMpIHtcclxuICAgICBpZiAoYnRuLnBhcmVudE5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb2xvcnNfX2l0ZW0tLWFjdGl2ZScpICYmIGUudGFyZ2V0ICE9PSBidG4gKSB7XHJcbiAgICAgICBidG4ucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjb2xvcnNfX2l0ZW0tLWFjdGl2ZScpXHJcbiAgICAgfVxyXG4gfSAgXHJcblxyXG4gIGZvciggbGV0IGJ0biBvZiBidXR0b25zQ29sb3JzKSB7XHJcbiAgICBpZiAoZS50YXJnZXQgPT09IGJ0bikge1xyXG4gICAgIGJ0bi5wYXJlbnROb2RlLmNsYXNzTGlzdC50b2dnbGUoJ2NvbG9yc19faXRlbS0tYWN0aXZlJyk7IFxyXG4gICB9XHJcbiAgfVxyXG4gIFxyXG4gICAgaWYgKGUudGFyZ2V0ID09PSBjbG9zZUNvbG9ycykge1xyXG4gICAgIGJ0bi5wYXJlbnROb2RlLmNsYXNzTGlzdC50b2dnbGUoJ2NvbG9yc19faXRlbS0tYWN0aXZlJyk7IFxyXG4gICB9XHJcbn0pO1xyXG59KSAoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG5jb25zdCBidXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRlYW1fX25hbWUnKTtcclxuY29uc3QgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50ZWFtX19saXN0Jyk7XHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcbiBmb3IoIGxldCBidG4gb2YgYnV0dG9ucykge1xyXG4gICAgIGlmIChidG4ucGFyZW50Tm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ3RlYW1fX2l0ZW0tLWFjdGl2ZScpICYmIGUudGFyZ2V0ICE9PSBidG4gKSB7XHJcbiAgICAgICBidG4ucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCd0ZWFtX19pdGVtLS1hY3RpdmUnKVxyXG4gICAgIH1cclxuIH0gIFxyXG5cclxuICBmb3IoIGxldCBidG4gb2YgYnV0dG9ucykge1xyXG4gICAgaWYgKGUudGFyZ2V0ID09PSBidG4pIHtcclxuICAgICBidG4ucGFyZW50Tm9kZS5jbGFzc0xpc3QudG9nZ2xlKCd0ZWFtX19pdGVtLS1hY3RpdmUnKTsgXHJcbiAgIH1cclxuICB9XHJcbn0pO1xyXG59KSAoKTtcclxuIiwiLy8gY29uc3QgbXlGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI215Rm9ybScpO1xyXG4vLyBjb25zdCBzZW5kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlbmQnKTtcclxuXHJcbi8vIHNlbmQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB7XHJcbi8vICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuLy8gICAgIGlmICh2YWxpZGF0ZUZvcm0obXlGb3JtKSkge1xyXG4vLyAgICAgICAgIGNvbnN0IGRhdGEgPSB7XHJcbi8vICAgICAgICAgICAgIG5hbWU6IG15Rm9ybS5lbGVtZW50cy5uYW1lLnZhbHVlLFxyXG4vLyAgICAgICAgICAgICBwaG9uZTogbXlGb3JtLmVsZW1lbnRzLnBob25lLnZhbHVlLFxyXG4vLyAgICAgICAgICAgICBlbWFpbDogbXlGb3JtLmVsZW1lbnRzLmVtYWlsLnZhbHVlLFxyXG4vLyAgICAgICAgICAgICBjb21tZW50OiBteUZvcm0uZWxlbWVudHMuY29tbWVudC52YWx1ZSxcclxuLy8gICAgICAgICB9O1xyXG5cclxuXHJcbi8vICAgICAgICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbi8vICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICdqc29uJztcclxuLy8gICAgICAgICB4aHIub3BlbignUE9TVCcsICdodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWwnKTtcclxuLy8gICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignY29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcclxuLy8gICAgICAgICB4aHIuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbi8vICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XHJcbi8vICAgICAgICAgICAgaWYgKHhoci5yZXNwb25zZS5zdGF0dXMpIHsgICAgICAgICAgICAgICAgICAgIFxyXG4vLyAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnb2snKTtcclxuLy8gICAgICAgICAgICB9XHJcbi8vICAgICAgICAgfSk7XHJcbi8vICAgICB9XHJcbi8vIH0pO1xyXG5cclxuLy8gZnVuY3Rpb24gdmFsaWRhdGVGb3JtKGZvcm0pe1xyXG4vLyAgICAgbGV0IHZhbGlkID0gdHJ1ZTtcclxuXHJcbi8vICAgICBpZiAoIXZhbGlkYXRlRmllbGQoZm9ybS5lbGVtZW50cy5uYW1lKSkge1xyXG4vLyAgICAgICAgIHZhbGlkID0gZmFsc2U7XHJcbi8vICAgICB9OyAgICBcclxuLy8gICAgIGlmICghdmFsaWRhdGVGaWVsZChmb3JtLmVsZW1lbnRzLnBob25lKSkge1xyXG4vLyAgICAgICAgIHZhbGlkID0gZmFsc2U7XHJcbi8vICAgICB9O1xyXG4vLyAgICAgaWYgKCF2YWxpZGF0ZUZpZWxkKGZvcm0uZWxlbWVudHMuZW1haWwpKSB7XHJcbi8vICAgICAgICAgdmFsaWQgPSBmYWxzZTtcclxuLy8gICAgIH07XHJcbi8vICAgICBpZiAoIXZhbGlkYXRlRmllbGQoZm9ybS5lbGVtZW50cy5jb21tZW50KSkge1xyXG4vLyAgICAgICAgIHZhbGlkID0gZmFsc2U7XHJcbi8vICAgICB9O1xyXG5cclxuLy8gICAgIHJldHVybiB2YWxpZDtcclxuLy8gfVxyXG5cclxuLy8gZnVuY3Rpb24gdmFsaWRhdGVGaWVsZChmaWVsZCkge1xyXG4vLyAgICAgZmllbGQubmV4dEVsZW1lbnRTaWJsaW5nLnRleHRDb250ZW50ID0gZmllbGQudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbi8vICAgICByZXR1cm4gZmllbGQuY2hlY2tWYWxpZGl0eSgpO1xyXG4vLyB9IiwiKGZ1bmN0aW9uKCkge1xyXG5sZXQgYnVyZ2VyICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXJnZXInKTtcclxubGV0IG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnVyZ2VyLW1lbnUnKTtcclxubGV0IGNsb3NlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXJnZXItbWVudV9fY2xvc2VyJyk7XHJcblxyXG5sZXQgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYnVyZ2VyLW1lbnVfX2xpbmsnKTtcclxuXHJcbmxpbmtzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCl7XHJcbiAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycgLCB0b2dnbGVNZW51KTtcclxufSlcclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZU1lbnUoKXtcclxuICBidXJnZXIuY2xhc3NMaXN0LnRvZ2dsZSgnYnVyZ2VyLS1hY3RpdmUnKTtcclxuICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ2J1cmdlci1tZW51LS1hY3RpdmUnKTtcclxuICBjbG9zZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY2xvc2VyJyk7XHJcbn1cclxuXHJcbmJ1cmdlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycgLCB0b2dnbGVNZW51KTtcclxufSkgKCk7IiwiKGZ1bmN0aW9uKCkge1xuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIGpxdWVyeS1vbmVwYWdlLXNjcm9sbC5qcyB2MS4zLjFcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMyBQZXRlIFJvandvbmdzdXJpeWEuXG4gKiBodHRwOi8vd3d3LnRoZXBldGVkZXNpZ24uY29tXG4gKlxuICogQ3JlYXRlIGFuIEFwcGxlLWxpa2Ugd2Vic2l0ZSB0aGF0IGxldCB1c2VyIHNjcm9sbFxuICogb25lIHBhZ2UgYXQgYSB0aW1lXG4gKlxuICogQ3JlZGl0OiBFaWtlIFNlbmQgZm9yIHRoZSBhd2Vzb21lIHN3aXBlIGV2ZW50XG4gKiBodHRwczovL2dpdGh1Yi5jb20vcGVhY2hhbmFuci9vbmVwYWdlLXNjcm9sbFxuICpcbiAqIExpY2Vuc2U6IEdQTCB2M1xuICpcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuIWZ1bmN0aW9uKCQpe1xuXG4gIHZhciBkZWZhdWx0cyA9IHtcbiAgICBzZWN0aW9uQ29udGFpbmVyOiBcInNlY3Rpb25cIixcbiAgICBlYXNpbmc6IFwiZWFzZVwiLFxuICAgIGFuaW1hdGlvblRpbWU6IDEwMDAsXG4gICAgcGFnaW5hdGlvbjogdHJ1ZSxcbiAgICB1cGRhdGVVUkw6IGZhbHNlLFxuICAgIGtleWJvYXJkOiB0cnVlLFxuICAgIGJlZm9yZU1vdmU6IG51bGwsXG4gICAgYWZ0ZXJNb3ZlOiBudWxsLFxuICAgIGxvb3A6IHRydWUsXG4gICAgcmVzcG9uc2l2ZUZhbGxiYWNrOiBmYWxzZSxcbiAgICBkaXJlY3Rpb24gOiAndmVydGljYWwnXG5cdH07XG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXHQvKiAgQ3JlZGl0OiBFaWtlIFNlbmQgZm9yIHRoZSBhd2Vzb21lIHN3aXBlIGV2ZW50ICovXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQkLmZuLnN3aXBlRXZlbnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBzdGFydFgsXG4gICAgICAgICAgICBzdGFydFksXG4gICAgICAgICAgICAkdGhpcyA9ICQodGhpcyk7XG5cbiAgICAgICAgJHRoaXMuYmluZCgndG91Y2hzdGFydCcsIHRvdWNoc3RhcnQpO1xuXG4gICAgICAgIGZ1bmN0aW9uIHRvdWNoc3RhcnQoZXZlbnQpIHtcbiAgICAgICAgICB2YXIgdG91Y2hlcyA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlcztcbiAgICAgICAgICBpZiAodG91Y2hlcyAmJiB0b3VjaGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgc3RhcnRYID0gdG91Y2hlc1swXS5wYWdlWDtcbiAgICAgICAgICAgIHN0YXJ0WSA9IHRvdWNoZXNbMF0ucGFnZVk7XG4gICAgICAgICAgICAkdGhpcy5iaW5kKCd0b3VjaG1vdmUnLCB0b3VjaG1vdmUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHRvdWNobW92ZShldmVudCkge1xuICAgICAgICAgIHZhciB0b3VjaGVzID0gZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzO1xuICAgICAgICAgIGlmICh0b3VjaGVzICYmIHRvdWNoZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB2YXIgZGVsdGFYID0gc3RhcnRYIC0gdG91Y2hlc1swXS5wYWdlWDtcbiAgICAgICAgICAgIHZhciBkZWx0YVkgPSBzdGFydFkgLSB0b3VjaGVzWzBdLnBhZ2VZO1xuXG4gICAgICAgICAgICBpZiAoZGVsdGFYID49IDUwKSB7XG4gICAgICAgICAgICAgICR0aGlzLnRyaWdnZXIoXCJzd2lwZUxlZnRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGVsdGFYIDw9IC01MCkge1xuICAgICAgICAgICAgICAkdGhpcy50cmlnZ2VyKFwic3dpcGVSaWdodFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkZWx0YVkgPj0gNTApIHtcbiAgICAgICAgICAgICAgJHRoaXMudHJpZ2dlcihcInN3aXBlVXBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGVsdGFZIDw9IC01MCkge1xuICAgICAgICAgICAgICAkdGhpcy50cmlnZ2VyKFwic3dpcGVEb3duXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRlbHRhWCkgPj0gNTAgfHwgTWF0aC5hYnMoZGVsdGFZKSA+PSA1MCkge1xuICAgICAgICAgICAgICAkdGhpcy51bmJpbmQoJ3RvdWNobW92ZScsIHRvdWNobW92ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH07XG5cblxuICAkLmZuLm9uZXBhZ2Vfc2Nyb2xsID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zKSxcbiAgICAgICAgZWwgPSAkKHRoaXMpLFxuICAgICAgICBzZWN0aW9ucyA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciksXG4gICAgICAgIHRvdGFsID0gc2VjdGlvbnMubGVuZ3RoLFxuICAgICAgICBzdGF0dXMgPSBcIm9mZlwiLFxuICAgICAgICB0b3BQb3MgPSAwLFxuICAgICAgICBsZWZ0UG9zID0gMCxcbiAgICAgICAgbGFzdEFuaW1hdGlvbiA9IDAsXG4gICAgICAgIHF1aWV0UGVyaW9kID0gNTAwLFxuICAgICAgICBwYWdpbmF0aW9uTGlzdCA9IFwiXCI7XG5cbiAgICAkLmZuLnRyYW5zZm9ybVBhZ2UgPSBmdW5jdGlvbihzZXR0aW5ncywgcG9zLCBpbmRleCkge1xuICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5iZWZvcmVNb3ZlID09ICdmdW5jdGlvbicpIHNldHRpbmdzLmJlZm9yZU1vdmUoaW5kZXgpO1xuXG4gICAgICAvLyBKdXN0IGEgc2ltcGxlIGVkaXQgdGhhdCBtYWtlcyB1c2Ugb2YgbW9kZXJuaXpyIHRvIGRldGVjdCBhbiBJRTggYnJvd3NlciBhbmQgY2hhbmdlcyB0aGUgdHJhbnNmb3JtIG1ldGhvZCBpbnRvXG4gICAgXHQvLyBhbiB0b3AgYW5pbWF0ZSBzbyBJRTggdXNlcnMgY2FuIGFsc28gdXNlIHRoaXMgc2NyaXB0LlxuICAgIFx0aWYoJCgnaHRtbCcpLmhhc0NsYXNzKCdpZTgnKSl7XG4gICAgICAgIGlmIChzZXR0aW5ncy5kaXJlY3Rpb24gPT0gJ2hvcml6b250YWwnKSB7XG4gICAgICAgICAgdmFyIHRvcHBvcyA9IChlbC53aWR0aCgpLzEwMCkqcG9zO1xuICAgICAgICAgICQodGhpcykuYW5pbWF0ZSh7bGVmdDogdG9wcG9zKydweCd9LHNldHRpbmdzLmFuaW1hdGlvblRpbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciB0b3Bwb3MgPSAoZWwuaGVpZ2h0KCkvMTAwKSpwb3M7XG4gICAgICAgICAgJCh0aGlzKS5hbmltYXRlKHt0b3A6IHRvcHBvcysncHgnfSxzZXR0aW5ncy5hbmltYXRpb25UaW1lKTtcbiAgICAgICAgfVxuICAgIFx0fSBlbHNle1xuICAgIFx0ICAkKHRoaXMpLmNzcyh7XG4gICAgXHQgICAgXCItd2Via2l0LXRyYW5zZm9ybVwiOiAoIHNldHRpbmdzLmRpcmVjdGlvbiA9PSAnaG9yaXpvbnRhbCcgKSA/IFwidHJhbnNsYXRlM2QoXCIgKyBwb3MgKyBcIiUsIDAsIDApXCIgOiBcInRyYW5zbGF0ZTNkKDAsIFwiICsgcG9zICsgXCIlLCAwKVwiLFxuICAgICAgICAgXCItd2Via2l0LXRyYW5zaXRpb25cIjogXCJhbGwgXCIgKyBzZXR0aW5ncy5hbmltYXRpb25UaW1lICsgXCJtcyBcIiArIHNldHRpbmdzLmVhc2luZyxcbiAgICAgICAgIFwiLW1vei10cmFuc2Zvcm1cIjogKCBzZXR0aW5ncy5kaXJlY3Rpb24gPT0gJ2hvcml6b250YWwnICkgPyBcInRyYW5zbGF0ZTNkKFwiICsgcG9zICsgXCIlLCAwLCAwKVwiIDogXCJ0cmFuc2xhdGUzZCgwLCBcIiArIHBvcyArIFwiJSwgMClcIixcbiAgICAgICAgIFwiLW1vei10cmFuc2l0aW9uXCI6IFwiYWxsIFwiICsgc2V0dGluZ3MuYW5pbWF0aW9uVGltZSArIFwibXMgXCIgKyBzZXR0aW5ncy5lYXNpbmcsXG4gICAgICAgICBcIi1tcy10cmFuc2Zvcm1cIjogKCBzZXR0aW5ncy5kaXJlY3Rpb24gPT0gJ2hvcml6b250YWwnICkgPyBcInRyYW5zbGF0ZTNkKFwiICsgcG9zICsgXCIlLCAwLCAwKVwiIDogXCJ0cmFuc2xhdGUzZCgwLCBcIiArIHBvcyArIFwiJSwgMClcIixcbiAgICAgICAgIFwiLW1zLXRyYW5zaXRpb25cIjogXCJhbGwgXCIgKyBzZXR0aW5ncy5hbmltYXRpb25UaW1lICsgXCJtcyBcIiArIHNldHRpbmdzLmVhc2luZyxcbiAgICAgICAgIFwidHJhbnNmb3JtXCI6ICggc2V0dGluZ3MuZGlyZWN0aW9uID09ICdob3Jpem9udGFsJyApID8gXCJ0cmFuc2xhdGUzZChcIiArIHBvcyArIFwiJSwgMCwgMClcIiA6IFwidHJhbnNsYXRlM2QoMCwgXCIgKyBwb3MgKyBcIiUsIDApXCIsXG4gICAgICAgICBcInRyYW5zaXRpb25cIjogXCJhbGwgXCIgKyBzZXR0aW5ncy5hbmltYXRpb25UaW1lICsgXCJtcyBcIiArIHNldHRpbmdzLmVhc2luZ1xuICAgIFx0ICB9KTtcbiAgICBcdH1cbiAgICAgICQodGhpcykub25lKCd3ZWJraXRUcmFuc2l0aW9uRW5kIG90cmFuc2l0aW9uZW5kIG9UcmFuc2l0aW9uRW5kIG1zVHJhbnNpdGlvbkVuZCB0cmFuc2l0aW9uZW5kJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLmFmdGVyTW92ZSA9PSAnZnVuY3Rpb24nKSBzZXR0aW5ncy5hZnRlck1vdmUoaW5kZXgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgJC5mbi5tb3ZlRG93biA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGVsID0gJCh0aGlzKVxuICAgICAgaW5kZXggPSAkKHNldHRpbmdzLnNlY3Rpb25Db250YWluZXIgK1wiLmFjdGl2ZVwiKS5kYXRhKFwiaW5kZXhcIik7XG4gICAgICBjdXJyZW50ID0gJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgXCJbZGF0YS1pbmRleD0nXCIgKyBpbmRleCArIFwiJ11cIik7XG4gICAgICBuZXh0ID0gJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgXCJbZGF0YS1pbmRleD0nXCIgKyAoaW5kZXggKyAxKSArIFwiJ11cIik7XG4gICAgICBpZihuZXh0Lmxlbmd0aCA8IDEpIHtcbiAgICAgICAgaWYgKHNldHRpbmdzLmxvb3AgPT0gdHJ1ZSkge1xuICAgICAgICAgIHBvcyA9IDA7XG4gICAgICAgICAgbmV4dCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArIFwiW2RhdGEtaW5kZXg9JzEnXVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICB9ZWxzZSB7XG4gICAgICAgIHBvcyA9IChpbmRleCAqIDEwMCkgKiAtMTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2Ygc2V0dGluZ3MuYmVmb3JlTW92ZSA9PSAnZnVuY3Rpb24nKSBzZXR0aW5ncy5iZWZvcmVNb3ZlKCBuZXh0LmRhdGEoXCJpbmRleFwiKSk7XG4gICAgICBjdXJyZW50LnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpXG4gICAgICBuZXh0LmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgaWYoc2V0dGluZ3MucGFnaW5hdGlvbiA9PSB0cnVlKSB7XG4gICAgICAgICQoXCIub25lcGFnZS1wYWdpbmF0aW9uIGxpIGFcIiArIFwiW2RhdGEtaW5kZXg9J1wiICsgaW5kZXggKyBcIiddXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAkKFwiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhXCIgKyBcIltkYXRhLWluZGV4PSdcIiArIG5leHQuZGF0YShcImluZGV4XCIpICsgXCInXVwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgIH1cblxuICAgICAgJChcImJvZHlcIilbMF0uY2xhc3NOYW1lID0gJChcImJvZHlcIilbMF0uY2xhc3NOYW1lLnJlcGxhY2UoL1xcYnZpZXdpbmctcGFnZS1cXGQuKj9cXGIvZywgJycpO1xuICAgICAgJChcImJvZHlcIikuYWRkQ2xhc3MoXCJ2aWV3aW5nLXBhZ2UtXCIrbmV4dC5kYXRhKFwiaW5kZXhcIikpXG5cbiAgICAgIGlmIChoaXN0b3J5LnJlcGxhY2VTdGF0ZSAmJiBzZXR0aW5ncy51cGRhdGVVUkwgPT0gdHJ1ZSkge1xuICAgICAgICB2YXIgaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnN1YnN0cigwLHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJyMnKSkgKyBcIiNcIiArIChpbmRleCArIDEpO1xuICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZSgge30sIGRvY3VtZW50LnRpdGxlLCBocmVmICk7XG4gICAgICB9XG4gICAgICBlbC50cmFuc2Zvcm1QYWdlKHNldHRpbmdzLCBwb3MsIG5leHQuZGF0YShcImluZGV4XCIpKTtcbiAgICB9XG5cbiAgICAkLmZuLm1vdmVVcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGVsID0gJCh0aGlzKVxuICAgICAgaW5kZXggPSAkKHNldHRpbmdzLnNlY3Rpb25Db250YWluZXIgK1wiLmFjdGl2ZVwiKS5kYXRhKFwiaW5kZXhcIik7XG4gICAgICBjdXJyZW50ID0gJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgXCJbZGF0YS1pbmRleD0nXCIgKyBpbmRleCArIFwiJ11cIik7XG4gICAgICBuZXh0ID0gJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgXCJbZGF0YS1pbmRleD0nXCIgKyAoaW5kZXggLSAxKSArIFwiJ11cIik7XG5cbiAgICAgIGlmKG5leHQubGVuZ3RoIDwgMSkge1xuICAgICAgICBpZiAoc2V0dGluZ3MubG9vcCA9PSB0cnVlKSB7XG4gICAgICAgICAgcG9zID0gKCh0b3RhbCAtIDEpICogMTAwKSAqIC0xO1xuICAgICAgICAgIG5leHQgPSAkKHNldHRpbmdzLnNlY3Rpb25Db250YWluZXIgKyBcIltkYXRhLWluZGV4PSdcIit0b3RhbCtcIiddXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICB9ZWxzZSB7XG4gICAgICAgIHBvcyA9ICgobmV4dC5kYXRhKFwiaW5kZXhcIikgLSAxKSAqIDEwMCkgKiAtMTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2Ygc2V0dGluZ3MuYmVmb3JlTW92ZSA9PSAnZnVuY3Rpb24nKSBzZXR0aW5ncy5iZWZvcmVNb3ZlKG5leHQuZGF0YShcImluZGV4XCIpKTtcbiAgICAgIGN1cnJlbnQucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIilcbiAgICAgIG5leHQuYWRkQ2xhc3MoXCJhY3RpdmVcIilcbiAgICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT0gdHJ1ZSkge1xuICAgICAgICAkKFwiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhXCIgKyBcIltkYXRhLWluZGV4PSdcIiArIGluZGV4ICsgXCInXVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgJChcIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYVwiICsgXCJbZGF0YS1pbmRleD0nXCIgKyBuZXh0LmRhdGEoXCJpbmRleFwiKSArIFwiJ11cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICB9XG4gICAgICAkKFwiYm9keVwiKVswXS5jbGFzc05hbWUgPSAkKFwiYm9keVwiKVswXS5jbGFzc05hbWUucmVwbGFjZSgvXFxidmlld2luZy1wYWdlLVxcZC4qP1xcYi9nLCAnJyk7XG4gICAgICAkKFwiYm9keVwiKS5hZGRDbGFzcyhcInZpZXdpbmctcGFnZS1cIituZXh0LmRhdGEoXCJpbmRleFwiKSlcblxuICAgICAgaWYgKGhpc3RvcnkucmVwbGFjZVN0YXRlICYmIHNldHRpbmdzLnVwZGF0ZVVSTCA9PSB0cnVlKSB7XG4gICAgICAgIHZhciBocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3Vic3RyKDAsd2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignIycpKSArIFwiI1wiICsgKGluZGV4IC0gMSk7XG4gICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKCB7fSwgZG9jdW1lbnQudGl0bGUsIGhyZWYgKTtcbiAgICAgIH1cbiAgICAgIGVsLnRyYW5zZm9ybVBhZ2Uoc2V0dGluZ3MsIHBvcywgbmV4dC5kYXRhKFwiaW5kZXhcIikpO1xuICAgIH1cblxuICAgICQuZm4ubW92ZVRvID0gZnVuY3Rpb24ocGFnZV9pbmRleCkge1xuICAgICAgY3VycmVudCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArIFwiLmFjdGl2ZVwiKVxuICAgICAgbmV4dCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArIFwiW2RhdGEtaW5kZXg9J1wiICsgKHBhZ2VfaW5kZXgpICsgXCInXVwiKTtcbiAgICAgIGlmKG5leHQubGVuZ3RoID4gMCkge1xuICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLmJlZm9yZU1vdmUgPT0gJ2Z1bmN0aW9uJykgc2V0dGluZ3MuYmVmb3JlTW92ZShuZXh0LmRhdGEoXCJpbmRleFwiKSk7XG4gICAgICAgIGN1cnJlbnQucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIilcbiAgICAgICAgbmV4dC5hZGRDbGFzcyhcImFjdGl2ZVwiKVxuICAgICAgICAkKFwiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhXCIgKyBcIi5hY3RpdmVcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICQoXCIub25lcGFnZS1wYWdpbmF0aW9uIGxpIGFcIiArIFwiW2RhdGEtaW5kZXg9J1wiICsgKHBhZ2VfaW5kZXgpICsgXCInXVwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgJChcImJvZHlcIilbMF0uY2xhc3NOYW1lID0gJChcImJvZHlcIilbMF0uY2xhc3NOYW1lLnJlcGxhY2UoL1xcYnZpZXdpbmctcGFnZS1cXGQuKj9cXGIvZywgJycpO1xuICAgICAgICAkKFwiYm9keVwiKS5hZGRDbGFzcyhcInZpZXdpbmctcGFnZS1cIituZXh0LmRhdGEoXCJpbmRleFwiKSlcblxuICAgICAgICBwb3MgPSAoKHBhZ2VfaW5kZXggLSAxKSAqIDEwMCkgKiAtMTtcblxuICAgICAgICBpZiAoaGlzdG9yeS5yZXBsYWNlU3RhdGUgJiYgc2V0dGluZ3MudXBkYXRlVVJMID09IHRydWUpIHtcbiAgICAgICAgICAgIHZhciBocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3Vic3RyKDAsd2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignIycpKSArIFwiI1wiICsgKHBhZ2VfaW5kZXggLSAxKTtcbiAgICAgICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKCB7fSwgZG9jdW1lbnQudGl0bGUsIGhyZWYgKTtcbiAgICAgICAgfVxuICAgICAgICBlbC50cmFuc2Zvcm1QYWdlKHNldHRpbmdzLCBwb3MsIHBhZ2VfaW5kZXgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlc3BvbnNpdmUoKSB7XG4gICAgICAvL3N0YXJ0IG1vZGlmaWNhdGlvblxuICAgICAgdmFyIHZhbEZvclRlc3QgPSBmYWxzZTtcbiAgICAgIHZhciB0eXBlT2ZSRiA9IHR5cGVvZiBzZXR0aW5ncy5yZXNwb25zaXZlRmFsbGJhY2tcblxuICAgICAgaWYodHlwZU9mUkYgPT0gXCJudW1iZXJcIil7XG4gICAgICBcdHZhbEZvclRlc3QgPSAkKHdpbmRvdykud2lkdGgoKSA8IHNldHRpbmdzLnJlc3BvbnNpdmVGYWxsYmFjaztcbiAgICAgIH1cbiAgICAgIGlmKHR5cGVPZlJGID09IFwiYm9vbGVhblwiKXtcbiAgICAgIFx0dmFsRm9yVGVzdCA9IHNldHRpbmdzLnJlc3BvbnNpdmVGYWxsYmFjaztcbiAgICAgIH1cbiAgICAgIGlmKHR5cGVPZlJGID09IFwiZnVuY3Rpb25cIil7XG4gICAgICBcdHZhbEZ1bmN0aW9uID0gc2V0dGluZ3MucmVzcG9uc2l2ZUZhbGxiYWNrKCk7XG4gICAgICBcdHZhbEZvclRlc3QgPSB2YWxGdW5jdGlvbjtcbiAgICAgIFx0dHlwZU9GdiA9IHR5cGVvZiB2YWxGb3JUZXN0O1xuICAgICAgXHRpZih0eXBlT0Z2ID09IFwibnVtYmVyXCIpe1xuICAgICAgXHRcdHZhbEZvclRlc3QgPSAkKHdpbmRvdykud2lkdGgoKSA8IHZhbEZ1bmN0aW9uO1xuICAgICAgXHR9XG4gICAgICB9XG5cbiAgICAgIC8vZW5kIG1vZGlmaWNhdGlvblxuICAgICAgaWYgKHZhbEZvclRlc3QpIHtcbiAgICAgICAgJChcImJvZHlcIikuYWRkQ2xhc3MoXCJkaXNhYmxlZC1vbmVwYWdlLXNjcm9sbFwiKTtcbiAgICAgICAgJChkb2N1bWVudCkudW5iaW5kKCdtb3VzZXdoZWVsIERPTU1vdXNlU2Nyb2xsIE1vek1vdXNlUGl4ZWxTY3JvbGwnKTtcbiAgICAgICAgZWwuc3dpcGVFdmVudHMoKS51bmJpbmQoXCJzd2lwZURvd24gc3dpcGVVcFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmKCQoXCJib2R5XCIpLmhhc0NsYXNzKFwiZGlzYWJsZWQtb25lcGFnZS1zY3JvbGxcIikpIHtcbiAgICAgICAgICAkKFwiYm9keVwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkLW9uZXBhZ2Utc2Nyb2xsXCIpO1xuICAgICAgICAgICQoXCJodG1sLCBib2R5LCAud3JhcHBlclwiKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiAwIH0sIFwiZmFzdFwiKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgZWwuc3dpcGVFdmVudHMoKS5iaW5kKFwic3dpcGVEb3duXCIsICBmdW5jdGlvbihldmVudCl7XG4gICAgICAgICAgaWYgKCEkKFwiYm9keVwiKS5oYXNDbGFzcyhcImRpc2FibGVkLW9uZXBhZ2Utc2Nyb2xsXCIpKSBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGVsLm1vdmVVcCgpO1xuICAgICAgICB9KS5iaW5kKFwic3dpcGVVcFwiLCBmdW5jdGlvbihldmVudCl7XG4gICAgICAgICAgaWYgKCEkKFwiYm9keVwiKS5oYXNDbGFzcyhcImRpc2FibGVkLW9uZXBhZ2Utc2Nyb2xsXCIpKSBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGVsLm1vdmVEb3duKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ21vdXNld2hlZWwgRE9NTW91c2VTY3JvbGwgTW96TW91c2VQaXhlbFNjcm9sbCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB2YXIgZGVsdGEgPSBldmVudC5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGEgfHwgLWV2ZW50Lm9yaWdpbmFsRXZlbnQuZGV0YWlsO1xuICAgICAgICAgIGluaXRfc2Nyb2xsKGV2ZW50LCBkZWx0YSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gaW5pdF9zY3JvbGwoZXZlbnQsIGRlbHRhKSB7XG4gICAgICAgIGRlbHRhT2ZJbnRlcmVzdCA9IGRlbHRhO1xuICAgICAgICB2YXIgdGltZU5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAvLyBDYW5jZWwgc2Nyb2xsIGlmIGN1cnJlbnRseSBhbmltYXRpbmcgb3Igd2l0aGluIHF1aWV0IHBlcmlvZFxuICAgICAgICBpZih0aW1lTm93IC0gbGFzdEFuaW1hdGlvbiA8IHF1aWV0UGVyaW9kICsgc2V0dGluZ3MuYW5pbWF0aW9uVGltZSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkZWx0YU9mSW50ZXJlc3QgPCAwKSB7XG4gICAgICAgICAgZWwubW92ZURvd24oKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVsLm1vdmVVcCgpXG4gICAgICAgIH1cbiAgICAgICAgbGFzdEFuaW1hdGlvbiA9IHRpbWVOb3c7XG4gICAgfVxuXG4gICAgLy8gUHJlcGFyZSBldmVyeXRoaW5nIGJlZm9yZSBiaW5kaW5nIHdoZWVsIHNjcm9sbFxuXG4gICAgZWwuYWRkQ2xhc3MoXCJvbmVwYWdlLXdyYXBwZXJcIikuY3NzKFwicG9zaXRpb25cIixcInJlbGF0aXZlXCIpO1xuICAgICQuZWFjaCggc2VjdGlvbnMsIGZ1bmN0aW9uKGkpIHtcbiAgICAgICQodGhpcykuY3NzKHtcbiAgICAgICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICAgICAgdG9wOiB0b3BQb3MgKyBcIiVcIlxuICAgICAgfSkuYWRkQ2xhc3MoXCJzZWN0aW9uXCIpLmF0dHIoXCJkYXRhLWluZGV4XCIsIGkrMSk7XG5cblxuICAgICAgJCh0aGlzKS5jc3Moe1xuICAgICAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgICAgICBsZWZ0OiAoIHNldHRpbmdzLmRpcmVjdGlvbiA9PSAnaG9yaXpvbnRhbCcgKVxuICAgICAgICAgID8gbGVmdFBvcyArIFwiJVwiXG4gICAgICAgICAgOiAwLFxuICAgICAgICB0b3A6ICggc2V0dGluZ3MuZGlyZWN0aW9uID09ICd2ZXJ0aWNhbCcgfHwgc2V0dGluZ3MuZGlyZWN0aW9uICE9ICdob3Jpem9udGFsJyApXG4gICAgICAgICAgPyB0b3BQb3MgKyBcIiVcIlxuICAgICAgICAgIDogMFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChzZXR0aW5ncy5kaXJlY3Rpb24gPT0gJ2hvcml6b250YWwnKVxuICAgICAgICBsZWZ0UG9zID0gbGVmdFBvcyArIDEwMDtcbiAgICAgIGVsc2VcbiAgICAgICAgdG9wUG9zID0gdG9wUG9zICsgMTAwO1xuXG5cbiAgICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT0gdHJ1ZSkge1xuICAgICAgICBwYWdpbmF0aW9uTGlzdCArPSBcIjxsaT48YSBkYXRhLWluZGV4PSdcIisoaSsxKStcIicgaHJlZj0nI1wiICsgKGkrMSkgKyBcIic+PC9hPjwvbGk+XCJcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGVsLnN3aXBlRXZlbnRzKCkuYmluZChcInN3aXBlRG93blwiLCAgZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgaWYgKCEkKFwiYm9keVwiKS5oYXNDbGFzcyhcImRpc2FibGVkLW9uZXBhZ2Utc2Nyb2xsXCIpKSBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZWwubW92ZVVwKCk7XG4gICAgfSkuYmluZChcInN3aXBlVXBcIiwgZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgaWYgKCEkKFwiYm9keVwiKS5oYXNDbGFzcyhcImRpc2FibGVkLW9uZXBhZ2Utc2Nyb2xsXCIpKSBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZWwubW92ZURvd24oKTtcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBQYWdpbmF0aW9uIGFuZCBEaXNwbGF5IFRoZW1cbiAgICBpZiAoc2V0dGluZ3MucGFnaW5hdGlvbiA9PSB0cnVlKSB7XG4gICAgICBpZiAoJCgndWwub25lcGFnZS1wYWdpbmF0aW9uJykubGVuZ3RoIDwgMSkgJChcIjx1bCBjbGFzcz0nb25lcGFnZS1wYWdpbmF0aW9uJz48L3VsPlwiKS5wcmVwZW5kVG8oXCJib2R5XCIpO1xuXG4gICAgICBpZiggc2V0dGluZ3MuZGlyZWN0aW9uID09ICdob3Jpem9udGFsJyApIHtcbiAgICAgICAgcG9zTGVmdCA9IChlbC5maW5kKFwiLm9uZXBhZ2UtcGFnaW5hdGlvblwiKS53aWR0aCgpIC8gMikgKiAtMTtcbiAgICAgICAgZWwuZmluZChcIi5vbmVwYWdlLXBhZ2luYXRpb25cIikuY3NzKFwibWFyZ2luLWxlZnRcIiwgcG9zTGVmdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwb3NUb3AgPSAoZWwuZmluZChcIi5vbmVwYWdlLXBhZ2luYXRpb25cIikuaGVpZ2h0KCkgLyAyKSAqIC0xO1xuICAgICAgICBlbC5maW5kKFwiLm9uZXBhZ2UtcGFnaW5hdGlvblwiKS5jc3MoXCJtYXJnaW4tdG9wXCIsIHBvc1RvcCk7XG4gICAgICB9XG4gICAgICAkKCd1bC5vbmVwYWdlLXBhZ2luYXRpb24nKS5odG1sKHBhZ2luYXRpb25MaXN0KTtcbiAgICB9XG5cbiAgICBpZih3aW5kb3cubG9jYXRpb24uaGFzaCAhPSBcIlwiICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoICE9IFwiIzFcIikge1xuICAgICAgaW5pdF9pbmRleCA9ICB3aW5kb3cubG9jYXRpb24uaGFzaC5yZXBsYWNlKFwiI1wiLCBcIlwiKVxuXG4gICAgICBpZiAocGFyc2VJbnQoaW5pdF9pbmRleCkgPD0gdG90YWwgJiYgcGFyc2VJbnQoaW5pdF9pbmRleCkgPiAwKSB7XG4gICAgICAgICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArIFwiW2RhdGEtaW5kZXg9J1wiICsgaW5pdF9pbmRleCArIFwiJ11cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIilcbiAgICAgICAgJChcImJvZHlcIikuYWRkQ2xhc3MoXCJ2aWV3aW5nLXBhZ2UtXCIrIGluaXRfaW5kZXgpXG4gICAgICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT0gdHJ1ZSkgJChcIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYVwiICsgXCJbZGF0YS1pbmRleD0nXCIgKyBpbml0X2luZGV4ICsgXCInXVwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcblxuICAgICAgICBuZXh0ID0gJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgXCJbZGF0YS1pbmRleD0nXCIgKyAoaW5pdF9pbmRleCkgKyBcIiddXCIpO1xuICAgICAgICBpZihuZXh0KSB7XG4gICAgICAgICAgbmV4dC5hZGRDbGFzcyhcImFjdGl2ZVwiKVxuICAgICAgICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT0gdHJ1ZSkgJChcIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYVwiICsgXCJbZGF0YS1pbmRleD0nXCIgKyAoaW5pdF9pbmRleCkgKyBcIiddXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICQoXCJib2R5XCIpWzBdLmNsYXNzTmFtZSA9ICQoXCJib2R5XCIpWzBdLmNsYXNzTmFtZS5yZXBsYWNlKC9cXGJ2aWV3aW5nLXBhZ2UtXFxkLio/XFxiL2csICcnKTtcbiAgICAgICAgICAkKFwiYm9keVwiKS5hZGRDbGFzcyhcInZpZXdpbmctcGFnZS1cIituZXh0LmRhdGEoXCJpbmRleFwiKSlcbiAgICAgICAgICBpZiAoaGlzdG9yeS5yZXBsYWNlU3RhdGUgJiYgc2V0dGluZ3MudXBkYXRlVVJMID09IHRydWUpIHtcbiAgICAgICAgICAgIHZhciBocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3Vic3RyKDAsd2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignIycpKSArIFwiI1wiICsgKGluaXRfaW5kZXgpO1xuICAgICAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoIHt9LCBkb2N1bWVudC50aXRsZSwgaHJlZiApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwb3MgPSAoKGluaXRfaW5kZXggLSAxKSAqIDEwMCkgKiAtMTtcbiAgICAgICAgZWwudHJhbnNmb3JtUGFnZShzZXR0aW5ncywgcG9zLCBpbml0X2luZGV4KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArIFwiW2RhdGEtaW5kZXg9JzEnXVwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKVxuICAgICAgICAkKFwiYm9keVwiKS5hZGRDbGFzcyhcInZpZXdpbmctcGFnZS0xXCIpXG4gICAgICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT0gdHJ1ZSkgJChcIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYVwiICsgXCJbZGF0YS1pbmRleD0nMSddXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgXCJbZGF0YS1pbmRleD0nMSddXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpXG4gICAgICAkKFwiYm9keVwiKS5hZGRDbGFzcyhcInZpZXdpbmctcGFnZS0xXCIpXG4gICAgICBpZihzZXR0aW5ncy5wYWdpbmF0aW9uID09IHRydWUpICQoXCIub25lcGFnZS1wYWdpbmF0aW9uIGxpIGFcIiArIFwiW2RhdGEtaW5kZXg9JzEnXVwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9XG5cbiAgICBpZihzZXR0aW5ncy5wYWdpbmF0aW9uID09IHRydWUpICB7XG4gICAgICAkKFwiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhXCIpLmNsaWNrKGZ1bmN0aW9uICgpe1xuICAgICAgICB2YXIgcGFnZV9pbmRleCA9ICQodGhpcykuZGF0YShcImluZGV4XCIpO1xuICAgICAgICBlbC5tb3ZlVG8ocGFnZV9pbmRleCk7XG4gICAgICB9KTtcbiAgICB9XG5cblxuICAgICQoZG9jdW1lbnQpLmJpbmQoJ21vdXNld2hlZWwgRE9NTW91c2VTY3JvbGwgTW96TW91c2VQaXhlbFNjcm9sbCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdmFyIGRlbHRhID0gZXZlbnQub3JpZ2luYWxFdmVudC53aGVlbERlbHRhIHx8IC1ldmVudC5vcmlnaW5hbEV2ZW50LmRldGFpbDtcbiAgICAgIGlmKCEkKFwiYm9keVwiKS5oYXNDbGFzcyhcImRpc2FibGVkLW9uZXBhZ2Utc2Nyb2xsXCIpKSBpbml0X3Njcm9sbChldmVudCwgZGVsdGEpO1xuICAgIH0pO1xuXG5cbiAgICBpZihzZXR0aW5ncy5yZXNwb25zaXZlRmFsbGJhY2sgIT0gZmFsc2UpIHtcbiAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc3BvbnNpdmUoKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXNwb25zaXZlKCk7XG4gICAgfVxuXG4gICAgaWYoc2V0dGluZ3Mua2V5Ym9hcmQgPT0gdHJ1ZSkge1xuICAgICAgJChkb2N1bWVudCkua2V5ZG93bihmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciB0YWcgPSBlLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgaWYgKCEkKFwiYm9keVwiKS5oYXNDbGFzcyhcImRpc2FibGVkLW9uZXBhZ2Utc2Nyb2xsXCIpKSB7XG4gICAgICAgICAgc3dpdGNoKGUud2hpY2gpIHtcbiAgICAgICAgICAgIGNhc2UgMzg6XG4gICAgICAgICAgICAgIGlmICh0YWcgIT0gJ2lucHV0JyAmJiB0YWcgIT0gJ3RleHRhcmVhJykgZWwubW92ZVVwKClcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA0MDpcbiAgICAgICAgICAgICAgaWYgKHRhZyAhPSAnaW5wdXQnICYmIHRhZyAhPSAndGV4dGFyZWEnKSBlbC5tb3ZlRG93bigpXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzI6IC8vc3BhY2ViYXJcbiAgICAgICAgICAgICAgaWYgKHRhZyAhPSAnaW5wdXQnICYmIHRhZyAhPSAndGV4dGFyZWEnKSBlbC5tb3ZlRG93bigpXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzM6IC8vcGFnZWcgdXBcbiAgICAgICAgICAgICAgaWYgKHRhZyAhPSAnaW5wdXQnICYmIHRhZyAhPSAndGV4dGFyZWEnKSBlbC5tb3ZlVXAoKVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM0OiAvL3BhZ2UgZHduXG4gICAgICAgICAgICAgIGlmICh0YWcgIT0gJ2lucHV0JyAmJiB0YWcgIT0gJ3RleHRhcmVhJykgZWwubW92ZURvd24oKVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM2OiAvL2hvbWVcbiAgICAgICAgICAgICAgZWwubW92ZVRvKDEpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM1OiAvL2VuZFxuICAgICAgICAgICAgICBlbC5tb3ZlVG8odG90YWwpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuXG59KHdpbmRvdy5qUXVlcnkpO1xuXG5cbiQoXCIubWFpblwiKS5vbmVwYWdlX3Njcm9sbCgpO1xufSkgKCk7IiwiKGZ1bmN0aW9uKCkge1xyXG5sZXQgbXlNYXA7XHJcblxyXG5jb25zdCBpbml0ID0gKCkgPT4geyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0YbQtdC90YLRgCDQutCw0YDRgtGLLCDQvdCw0YHRgtGA0L7QudC60Lgg0LfRg9C80LAsINC+0YLQutC70Y7Rh9C40YLRjCDQstGB0LUg0LrQvdC+0L/QutC4XHJcbiAgICBteU1hcCA9IG5ldyB5bWFwcy5NYXAoJ21hcCcsIHtcclxuICAgICAgICBjZW50ZXI6IFs1NS4xNjAwMjgsIDYxLjQwMjU5MF0sXHJcbiAgICAgICAgem9vbTogMTMsXHJcbiAgICAgICAgY29udHJvbHM6IFtdXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBjb29yZHMgPSBbICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINC60L7QvtGA0LTQuNC90LDRgtGLINGB0L7QsdGB0YLQstC10L3QvdGL0YUg0YLQvtGH0LXQulxyXG4gICAgICAgIFs1NS4xNTIzMjAsIDYxLjM4ODg1OF0sXHJcbiAgICAgICAgWzU1LjE2OTIxNCwgNjEuMzg3MTQ2XSxcclxuICAgICAgICBbNTUuMTYzNTY1LCA2MS40MTQ0MTldLFxyXG4gICAgICAgIFs1NS4xNzYwNjAsIDYxLjM5NzIxOF1cclxuICAgIF07XHJcblxyXG4gICAgY29uc3QgbXlDb2xsZWN0aW9uID0gbmV3IHltYXBzLkdlb09iamVjdENvbGxlY3Rpb24oe30sIHsgICAgICAvLyDQvdCw0YHRgtGA0L7QudC60Lgg0LjQutC+0L3QvtC6INC60L7Qu9C70LXQutGG0LjQuFxyXG4gICAgICAgIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgICAgICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG4gICAgICAgIGljb25JbWFnZUhyZWY6ICcuL2ltYWdlcy9zeW1ib2wvbWFya2VyLnN2ZycsXHJcbiAgICAgICAgaWNvbkltYWdlU2l6ZTogWzU4LCA3NF0sXHJcbiAgICAgICAgaWNvbkltYWdlT2Zmc2V0OiBbMCwgMF1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvb3Jkcy5mb3JFYWNoKGNvb3JkID0+IHtcclxuICAgICAgICBteUNvbGxlY3Rpb24uYWRkKG5ldyB5bWFwcy5QbGFjZW1hcmsoY29vcmQpKTsgICAgICAgICAgICAgLy8g0L/QtdGA0LXQsdGA0LDQu9C4INC4INC00L7QsdCw0LLQuNC70Lgg0LrQvtC+0YDQtNC40L3QsNGC0Ysg0LTQu9GPINGB0LLQvtC40YUg0YLQvtGH0LXQulxyXG4gICAgfSk7XHJcblxyXG4gICAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlDb2xsZWN0aW9uKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQtNC+0LHQsNCy0LjQu9C4INGB0LLQvtGOINC60L7Qu9C70LXQutGG0LjRjlxyXG5cclxuICAgIG15TWFwLmJlaGF2aW9ycy5kaXNhYmxlKCdzY3JvbGxab29tJyk7ICAgICAgICAgICAgICAgICAgICAgICAgLy8g0L7RgtC60LvRjtGH0LXQvSDQt9GD0Lwg0LrQvtC70ZHRgdC40LrQvtC8XHJcbn1cclxuXHJcbnltYXBzLnJlYWR5KGluaXQpO1xyXG59KSAoKTsiLCIoZnVuY3Rpb24oKSB7XHJcbmNvbnN0IHZhbGlkYXRlRmllbGRzID0gKGZvcm0sIGZpZWxkc0FycmF5KSA9PiB7XHJcbiAgZmllbGRzQXJyYXkuZm9yRWFjaCgoZmllbGQpID0+IHtcclxuICAgIGZpZWxkLnJlbW92ZUNsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICBpZiAoZmllbGQudmFsKCkgPT09IFwiXCIpIHtcclxuICAgICAgZmllbGQuYWRkQ2xhc3MoXCJpbnB1dC1lcnJvclwiKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgY29uc3QgZXJyb3JGaWVsZHMgPSBmb3JtLmZpbmQoXCIuaW5wdXQtZXJyb3JcIik7XHJcblxyXG4gIHJldHVybiBlcnJvckZpZWxkcy5sZW5ndGggPT09IDA7XHJcbn07XHJcblxyXG4kKFwiLm9yZGVyX19mb3JtXCIpLnN1Ym1pdCgoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWU9J25hbWUnXVwiKTtcclxuICBjb25zdCBwaG9uZSA9IGZvcm0uZmluZChcIltuYW1lPSdwaG9uZSddXCIpO1xyXG4gIGNvbnN0IGNvbW1lbnQgPSBmb3JtLmZpbmQoXCJbbmFtZT0nY29tbWVudCddXCIpO1xyXG4gIGNvbnN0IHRvID0gZm9ybS5maW5kKFwiW25hbWU9J3RvJ11cIik7XHJcblxyXG4gIGNvbnN0IG1vZGFsID0gJChcIiNtb2RhbFwiKTtcclxuICBjb25zdCBjb250ZW50ID0gbW9kYWwuZmluZChcIi5tb2RhbF9fY29udGVudFwiKTtcclxuXHJcbiAgbW9kYWwucmVtb3ZlQ2xhc3MoXCJlcnJvci1tb2RhbFwiKTtcclxuXHJcbiAgY29uc3QgaXNWYWxpZCA9IHZhbGlkYXRlRmllbGRzKGZvcm0sIFtuYW1lLCBwaG9uZSwgY29tbWVudCwgdG9dKTtcclxuXHJcbiAgaWYgKGlzVmFsaWQpIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICB1cmw6IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsXCIsXHJcbiAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcclxuICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxyXG4gICAgICAgIHRvOiB0by52YWwoKSxcclxuICAgICAgfSxcclxuICAgICAgZXJyb3I6IChkYXRhKSA9PiB7fSxcclxuICAgIH0pO1xyXG5cclxuICAgIHJlcXVlc3QuZG9uZSgoZGF0YSkgPT4ge1xyXG4gICAgICBjb250ZW50LnRleHQoZGF0YS5tZXNzYWdlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJlcXVlc3QuZmFpbCgoZGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5yZXNwb25zZUpTT04ubWVzc2FnZTtcclxuICAgICAgY29udGVudC50ZXh0KG1lc3NhZ2UpO1xyXG4gICAgICBtb2RhbC5hZGRDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmVxdWVzdC5hbHdheXMoKCkgPT4ge1xyXG4gICAgICAkLmZhbmN5Ym94Lm9wZW4oe1xyXG4gICAgICAgIHNyYzogXCIjbW9kYWxcIixcclxuICAgICAgICB0eXBlOiBcImlubGluZVwiLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4kKFwiLmpzLWNsb3NlLW1vZGFsXCIpLmNsaWNrKChlKSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnNvbGUubG9nKCdrbGlrJyk7XHJcbiAgY29uc3QgZm9ybSA9ICQoJy5vcmRlcl9fZm9ybScpO1xyXG4gIGNvbnN0IG5hbWUgPSBmb3JtLmZpbmQoXCJbbmFtZT0nbmFtZSddXCIpO1xyXG4gIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWU9J3Bob25lJ11cIik7XHJcbiAgY29uc3QgY29tbWVudCA9IGZvcm0uZmluZChcIltuYW1lPSdjb21tZW50J11cIilcclxuXHJcbiAgY29tbWVudC52YWwoJycpO1xyXG4gIG5hbWUudmFsKFwiXCIpXHJcbiAgcGhvbmUudmFsKFwiXCIpXHJcbiAgXHJcbiAgJC5mYW5jeWJveC5jbG9zZSgpO1xyXG59KTtcclxufSkgKCk7IiwiXHJcbi8vIC8vIGZ1bmN0aW9uIHN1Ym1pdEZvcm0gKG9Gb3JtRWxlbWVudCkge1xyXG4vLyAvLyAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4vLyAvLyAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xyXG4vLyAvLyAgICAgICAgIGFsZXJ0ICh4aHIucmVzcG9uc2VUZXh0KTsgXHJcbi8vIC8vICAgICB9XHJcbi8vIC8vICAgICB4aHIub3BlbiAob0Zvcm1FbGVtZW50Lm1ldGhvZCwgb0Zvcm1FbGVtZW50LmFjdGlvbiwgdHJ1ZSk7XHJcbi8vIC8vICAgICB4aHIuc2VuZCAobmV3IEZvcm1EYXRhIChvRm9ybUVsZW1lbnQpKTtcclxuLy8gLy8gICAgIHJldHVybiBmYWxzZTtcclxuLy8gLy8gfVxyXG5cclxuLy8gLy8geGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xyXG4vLyAvLyAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT0gNCAmJiB0aGlzLnN0YXR1cyA9PSAyMDApIHtcclxuLy8gLy8gICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZSh0aGlzLnJlc3BvbnNlVGV4dCk7XHJcbi8vIC8vICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuLy8gLy8gICB9XHJcbi8vIC8vIH07XHJcblxyXG5cclxuLy8gJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xyXG5cclxuLy8gICAgICQoJy5idXR0b24nKS5vbignY2xpY2snLCBlID0+IHtcclxuXHJcbi8vICAgICAgICAgbGV0IGJsb2NrID0gJCgnLnR5cGVfX2Zvcm06bGFzdC1jaGlsZCcpO1xyXG5cclxuLy8gICAgICAgICBsZXQgdmFsdWUgPSBibG9jay52YWwoKTsgICAgICAgICAvLyDQv9C+0LvRg9GH0LjRgtGMINGC0L4sINGH0YLQviDQstCy0L7QtNGP0YIg0LIg0YLQtdC60YHRgtC+0LLQvtC1INC/0L7Qu9C1IFxyXG5cclxuLy8gICAgICAgICBjb25zb2xlLmxvZyh2YWx1ZSk7XHJcblxyXG4vLyAgICAgICAgIC8vIGxldCBibG9jayA9ICQoJy5yYWRpbzpjaGVja2VkJyk7XHJcbi8vICAgICAgICAgLy8gbGV0IGJsb2NrID0gJCgnI3NlbGVjdCcpO1xyXG4vLyAgICAgICAgIC8vIGxldCBibG9jayA9ICQoJyNmaWxlJyk7ICAgICAgICAgLy8g0LjQvNGPINGE0LDQudC70LAg0YEg0L/RgNC40YHRgtCw0LLQutC+0LkgZmFrZXBhdGhcclxuLy8gICAgIH0pXHJcbi8vIH0pIiwiKGZ1bmN0aW9uKCkge1xyXG4vLyBsZXQgcGxheWVyO1xyXG4vLyBjb25zdCBwbGF5ZXJDb250YWluZXIgPSAkKCcucGxheWVyJyk7XHJcblxyXG5cclxuLy8gbGV0IGV2ZW50c0luaXQgPSAoKSA9PiB7XHJcbi8vICAgICAkKCcucGxheWVyX19zdGFydCcpLmNsaWNrKGUgPT4ge1xyXG4vLyAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbi8vICAgICAgICAgaWYgKHBsYXllckNvbnRhaW5lci5oYXNDbGFzcygncGF1c2VkJykpIHtcclxuLy8gICAgICAgICAgICAgcGxheWVyLnBhdXNlKCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0L/QviDQutC70LjQutGDINGB0YLQsNGA0YIsINC10YHQu9C4INCy0LjQtNC10L4g0LHRi9C70L4g0L3QsCDQv9Cw0YPQt9C1XHJcbi8vICAgICAgICAgfSBlbHNlIHtcclxuLy8gICAgICAgICAgICAgcGxheWVyLnBsYXkoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0L/QviDQutC70LjQutGDINC/0LDRg9C30LAsINC10YHQu9C4INCy0LjQtNC10L4g0L/RgNC+0LjQs9GA0YvQstCw0LvQvtGB0YxcclxuLy8gICAgICAgICB9XHJcbi8vICAgICB9KTtcclxuXHJcbi8vICAgICAkKCcucGxheWVyX19wbGF5YmFjaycpLmNsaWNrKGUgPT4geyAgICAgICAgICAgICAgICAgICAgICAgIC8vINC/0L4g0LrQu9C40LrRgyDQvdCwINC/0YDQvtC60YDRg9GC0LrRgyDQv9C10YDQtdC80LDRgtGL0LLQsNC10Lwg0LLQuNC00L7RgVxyXG4vLyAgICAgICAgIGNvbnN0IGJhciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuXHJcbi8vICAgICAgICAgY29uc3QgY2xpY2tlZFBvc2l0aW9uID0gZS5vcmlnaW5hbEV2ZW50LmxheWVyWDtcclxuLy8gICAgICAgICBjb25zdCBuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnQgPSAoY2xpY2tlZFBvc2l0aW9uIC8gYmFyLndpZHRoKCkpICogMTAwO1xyXG4vLyAgICAgICAgIGNvbnN0IG5ld1BsYXliYWNrUG9zaXRpb25TZWMgPSAocGxheWVyLmdldER1cmF0aW9uKCkgLyAxMDApICogbmV3QnV0dG9uUG9zaXRpb25QZXJjZW50O1xyXG5cclxuLy8gICAgICAgICAkKCcucGxheWVyX19wbGF5YmFjay1idXR0b24nKS5jc3Moe1xyXG4vLyAgICAgICAgICAgICBsZWZ0OiBgJHtuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnR9JWBcclxuLy8gICAgICAgICB9KTtcclxuXHJcbi8vICAgICAgICAgcGxheWVyLnNlZWtUbyhuZXdQbGF5YmFja1Bvc2l0aW9uU2VjKTtcclxuLy8gICAgIH0pXHJcbiAgICBcclxuLy8gICAgICQoJy5wbGF5ZXJfX3ZvbHVtZScpLmNsaWNrKGUgPT4ge1xyXG4vLyAgICAgICAgIGNvbnN0IHZvbEJhciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuXHJcbi8vICAgICAgICAgY29uc3QgY2xpY2tlZFZvbCA9IGUub3JpZ2luYWxFdmVudC5sYXllclg7XHJcbi8vICAgICAgICAgY29uc3QgbmV3QnV0dG9uUG9zaXRpb25Wb2xQZXJjZW50ID0gKGNsaWNrZWRWb2wgLyB2b2xCYXIud2lkdGgoKSkgKiAxMDA7XHJcbi8vICAgICAgICAgY29uc3QgbmV3Vm9sUG9zaXRpb24gPSBjbGlja2VkVm9sIC8gdm9sQmFyLndpZHRoKCk7XHJcblxyXG4gICAgICAgIFxyXG4vLyAgICAgICAgICQoJy5wbGF5ZXJfX3ZvbHVtZS1idXR0b24nKS5jc3Moe1xyXG4vLyAgICAgICAgICAgICBsZWZ0OiBgJHtuZXdCdXR0b25Qb3NpdGlvblZvbFBlcmNlbnR9JWBcclxuLy8gICAgICAgICB9KTtcclxuXHJcbi8vICAgICAgICAgcGxheWVyLnZvbHVtZShuZXdWb2xQb3NpdGlvbik7ICAgICAgXHJcbi8vICAgICB9KTtcclxuICAgIFxyXG4vLyAgICAgJCgnLnBsYXllcl9fc3BsYXNoJykuY2xpY2soZSA9PiB7XHJcbi8vICAgICAgICAgcGxheWVyLnBsYXkoKTtcclxuLy8gICAgIH0pXHJcblxyXG4vLyB9O1xyXG5cclxuLy8gY29uc3QgZm9ybWF0VGltZSA9IHRpbWVTZWMgPT4ge1xyXG4vLyAgICAgY29uc3Qgcm91bmRUaW1lID0gTWF0aC5yb3VuZCh0aW1lU2VjKTtcclxuXHJcbi8vICAgICBjb25zdCBtaW51dGVzID0gYWRkWmVybyhNYXRoLmZsb29yKHJvdW5kVGltZSAvIDYwKSk7XHJcbi8vICAgICBjb25zdCBzZWNvbmRzID0gYWRkWmVybyhyb3VuZFRpbWUgLSBtaW51dGVzICogNjApO1xyXG5cclxuLy8gICAgIGZ1bmN0aW9uIGFkZFplcm8obnVtKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDRhNGD0L3QutGG0LjRjywg0YfRgtC+0LHRiyDQvdCwINCy0LjQtNC+0YHQsNGFINC60L7RgNC+0YfQtSAxMCDQvNC40L3Rg9GCINCyINC90LDRh9Cw0LvQtSDQsdGL0Lsg0L3QvtC70LjQulxyXG4vLyAgICAgICAgIHJldHVybiBudW0gPCAxMCA/IGAwJHtudW19YDpudW07XHJcbi8vICAgICB9XHJcblxyXG4vLyAgICAgcmV0dXJuIGAke21pbnV0ZXN9OiR7c2Vjb25kc31gOyAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQstGA0LXQvNGPINCy0L7Qt9Cy0YDQsNGJ0LDQtdGC0YHRjyDQsiDQvtCx0YvRh9C90L7QvCDRhNC+0YDQvNCw0YLQtVxyXG4vLyB9OyAgXHJcblxyXG4vLyBjb25zdCBvblBsYXllclJlYWR5ID0gKCkgPT4ge1xyXG4vLyAgICAgbGV0IGludGVydmFsO1xyXG4vLyAgICAgY29uc3QgZHVyYXRpb25TZWMgPSBwbGF5ZXIuZ2V0RHVyYXRpb24oKTtcclxuXHJcbi8vICAgICAkKCcucGxheWVyX19kdXJhdGlvbi1lc3RpbWF0ZScpLnRleHQoZm9ybWF0VGltZShkdXJhdGlvblNlYykpO1xyXG5cclxuLy8gICAgIGlmICh0eXBlb2YgaW50ZXJ2YWwgIT0gJ3VuZGVmaW5lZCcpIHtcclxuLy8gICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsKTtcclxuLy8gICAgIH1cclxuXHJcbi8vICAgICBpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuLy8gICAgICAgICBjb25zdCBjb21wbGV0ZWRTZWMgPSBwbGF5ZXIuZ2V0Q3VycmVudFRpbWUoKTtcclxuLy8gICAgICAgICBjb25zdCBjb21wbGV0ZWRQZXJjZW50ID0gKGNvbXBsZXRlZFNlYyAvIGR1cmF0aW9uU2VjKSAqIDEwMDtcclxuXHJcbi8vICAgICAgICAgJCgnLnBsYXllcl9fcGxheWJhY2stYnV0dG9uJykuY3NzKHsgICAgICAgICAgICAgICAgICAgICAvLyDQv9C+0LvQvtGB0LrQsCDQv9GA0L7QutGA0YPRgtC60Lgg0LTQstC40LPQsNC10YLRgdGPINC/0LDRgNCw0LvQu9C10LvRjNC90L4g0YLQtdC60YPRidC10Lkg0YLQvtGH0LrQtSDQstC40LTQtdC+XHJcbi8vICAgICAgICAgICAgIGxlZnQ6IGAke2NvbXBsZXRlZFBlcmNlbnR9JWAgXHJcbi8vICAgICAgICAgfSk7XHJcblxyXG4vLyAgICAgICAgICQoJy5wbGF5ZXJfX2R1cmF0aW9uLWNvbXBsZXRlZCcpLnRleHQoZm9ybWF0VGltZShjb21wbGV0ZWRTZWMpKTtcclxuLy8gICAgIH0sIDEwMDApOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICDRgdC60L7Qu9GM0LrQviDRgdC10LrRg9C90LQg0LLQuNC00L7RgdCwINC/0YDQvtGI0LvQviAtINGB0YLQvtC70YzQutC+INC4INC+0YLQvtCx0YDQsNC30LjQu9C+0YHRjFxyXG4vLyB9O1xyXG5cclxuLy8gY29uc3Qgb25QbGF5ZXJTdGF0ZUNoYW5nZSA9IGV2ZW50ID0+IHtcclxuXHJcbi8vICAgICAvLyAtMSAo0LLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNC1INCy0LjQtNC10L4g0L3QtSDQvdCw0YfQsNGC0L4pXHJcbi8vICAgICAvLyAwICjQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40LUg0LLQuNC00LXQviDQt9Cw0LLQtdGA0YjQtdC90L4pXHJcbi8vICAgICAvLyAxICjQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40LUpXHJcbi8vICAgICAvLyAyICjQv9Cw0YPQt9CwKVxyXG4vLyAgICAgLy8gMyAo0LHRg9GE0LXRgNC40LfQsNGG0LjRjylcclxuLy8gICAgIC8vIDUgKNCy0LjQtNC10L4g0L/QvtC00LDRjtGCINGA0LXQv9C70LjQutC4KS5cclxuXHJcbi8vICAgICBzd2l0Y2ggKGV2ZW50LmRhdGEpIHtcclxuLy8gICAgICAgICBjYXNlIDE6XHJcbi8vICAgICAgICAgICAgIHBsYXllckNvbnRhaW5lci5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbi8vICAgICAgICAgICAgIHBsYXllckNvbnRhaW5lci5hZGRDbGFzcygncGF1c2VkJyk7XHJcbi8vICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuLy8gICAgICAgICBjYXNlIDI6XHJcbi8vICAgICAgICAgICAgIHBsYXllckNvbnRhaW5lci5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbi8vICAgICAgICAgICAgIHBsYXllckNvbnRhaW5lci5yZW1vdmVDbGFzcygncGF1c2VkJyk7XHJcbi8vICAgICAgICAgICAgIGJyZWFrO1xyXG4vLyAgICAgfVxyXG4vLyB9XHJcblxyXG4vLyBmdW5jdGlvbiBvbllvdVR1YmVJZnJhbWVBUElSZWFkeSgpIHtcclxuLy8gICAgIHBsYXllciA9IG5ldyBZVC5QbGF5ZXIoJ3l0LXBsYXllcicsIHtcclxuLy8gICAgICAgICBoZWlnaHQ6ICc0MDUnLFxyXG4vLyAgICAgICAgIHdpZHRoOiAnNjYwJyxcclxuLy8gICAgICAgICB2aWRlb0lkOiAnTTdsYzFVVmYtVkUnLFxyXG4vLyAgICAgICAgIGV2ZW50czoge1xyXG4vLyAgICAgICAgICdvblJlYWR5Jzogb25QbGF5ZXJSZWFkeSxcclxuLy8gICAgICAgICAnb25TdGF0ZUNoYW5nZSc6IG9uUGxheWVyU3RhdGVDaGFuZ2VcclxuLy8gICAgICAgICB9LFxyXG4vLyAgICAgICAgIHBsYXllclZhcnM6IHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0YPQsdC40YDQsNC10Lwg0YHRgtCw0L3QtNCw0YDRgtC90YvQtSDRjdC70LXQvNC10L3RgtGLINC40L3RgtC10YDRhNC10LnRgdCwLCDQutC+0YLQvtGA0YvQtSDRgdC00LXQu9Cw0LXQvCDRgdCw0LzQuFxyXG4vLyAgICAgICAgICAgICBjb250cm9sczogMCxcclxuLy8gICAgICAgICAgICAgZGlzYWJsZWtiOiAwLFxyXG4vLyAgICAgICAgICAgICBzaG93aW5mbzogMCxcclxuLy8gICAgICAgICAgICAgcmVsOiAwLFxyXG4vLyAgICAgICAgICAgICBhdXRvcGxheTogMCxcclxuLy8gICAgICAgICAgICAgbW9kZXN0YnJhbmRpbmc6IDBcclxuLy8gICAgICAgICB9XHJcbi8vICAgICB9KTtcclxuLy8gfVxyXG5cclxuLy8gZXZlbnRzSW5pdCgpO1xyXG5cclxuXHJcbi8vLyDQniDQs9C+0YHQv9C+0LTQuCwg0Y3RgtC+INC20LUgSFRNTDUg0YDQtdGI0LXQvdC40LUhISEhMTExXHJcblxyXG5jb25zdCBwbGF5ZXJDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyJyk7XHJcbmNvbnN0IHBsYXllcldyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyX19jb250ZW50Jyk7XHJcbmNvbnN0IHZpZGVvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI215dmlkZW8nKTtcclxuY29uc3QgcGxheWVyU3RhcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyX19zdGFydCcpO1xyXG5jb25zdCBwbGF5ZXJQbGF5YmFjayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXJfX3BsYXliYWNrJyk7XHJcbmNvbnN0IHByb2dyZXNzQmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllcl9fcGxheWJhY2stbGluZScpO1xyXG5jb25zdCBwbGF5ZXJWaWRlb0NpcmNsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXJfX3BsYXliYWNrLWJ1dHRvbicpO1xyXG5jb25zdCBwbGF5ZXJWb2x1bWVJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllcl9fdm9sdW1lLXN2ZycpO1xyXG5jb25zdCBwbGF5ZXJWb2x1bWVCYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyX192b2x1bWUnKTtcclxuY29uc3QgcGxheWVyVm9sdW1lQ2lybGNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllcl9fdm9sdW1lLWJ1dHRvbicpO1xyXG5sZXQgc3RhcnRWb2x1bWUgPSAwO1xyXG5sZXQgY3VycmVudFZvbHVtZTtcclxuXHJcbi8vLyDQt9Cw0L/Rg9GB0LpcclxuXHJcbmNvbnN0IGhhbmRsZVN0YXJ0ID0gKCkgPT4ge1xyXG4gICAgdmlkZW8ucGF1c2VkID8gdmlkZW8ucGxheSgpIDogdmlkZW8ucGF1c2UoKTtcclxuICAgIC8vIGlmKHZpZGVvLnBhdXNlZCkge1xyXG4gICAgLy8gICAgIHZpZGVvLnBsYXkoKTtcclxuICAgIC8vIH0gZWxzZSB7XHJcbiAgICAvLyAgICAgdmlkZW8ucGF1c2UoKTtcclxuICAgIC8vIH1cclxufVxyXG5cclxucGxheWVyU3RhcnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTdGFydCk7XHJcbnBsYXllcldyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTdGFydCk7XHJcblxyXG5cclxuLy8vIHBsYXkvcGF1c2VcclxuXHJcbnZpZGVvLm9ucGxheSA9ICgpID0+IHtcclxuICAgIHRvZ2dsZVBsYXllcigpO1xyXG59XHJcblxyXG52aWRlby5vbnBhdXNlID0gKCkgPT4ge1xyXG4gICAgdG9nZ2xlUGxheWVyKCdwYXVzZScpO1xyXG59XHJcblxyXG5jb25zdCB0b2dnbGVQbGF5ZXIgPSAoIGFjdGlvbiA9ICdzdGFydCcpID0+IHtcclxuICAgIGFjdGlvbiA9PT0gJ3N0YXJ0JyA/IHBsYXllckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdwbGF5ZXJfYWN0aXZlJykgOiBwbGF5ZXJDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgncGxheWVyX2FjdGl2ZScpO1xyXG59XHJcblxyXG5cclxuLy8vINC40LfQvNC10L3QtdC90LjQtSDQt9Cy0YPQutCwIFxyXG5cclxuY29uc3QgY2hhbmdlVm9sdW1lID0gKGUpID0+IHtcclxuICAgIC8vIGNvbnN0IHtjdXJyZW50VGFyZ2V0fSA9IGU7XHJcbiAgICBjb25zdCBjdXJyZW50VGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0O1xyXG4gICAgY29uc3QgbGVmdCA9IGN1cnJlbnRUYXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcclxuICAgIGNvbnN0IHNvdW5kQmFyV2lkdGggPSBwYXJzZUludChnZXRDb21wdXRlZFN0eWxlKGN1cnJlbnRUYXJnZXQpLndpZHRoKTtcclxuICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0gZS5wYWdlWCAtIGxlZnQ7XHJcbiAgICBjb25zdCBwZXJjZW50VmFsdWUgPSAobmV3UG9zaXRpb24gLyBzb3VuZEJhcldpZHRoKSAqIDEwMDtcclxuICAgIGlmIChwZXJjZW50VmFsdWUgPCAxMDApIHtcclxuICAgICAgICB2aWRlby52b2x1bWUgPSBwZXJjZW50VmFsdWUgLyAxMDA7XHJcbiAgICAgICAgcGxheWVyVm9sdW1lQ2lybGNlLnN0eWxlLmxlZnQgPSBgJHtwZXJjZW50VmFsdWV9JWA7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5jb25zdCB0b2dnbGVTb3VuZCA9ICgpID0+IHtcclxuICAgIHBsYXllclZvbHVtZUljb24uY2xhc3NMaXN0LnRvZ2dsZSgnbXV0ZWQnKTtcclxuXHJcbiAgICBpZih2aWRlby52b2x1bWUgPT09IDApIHtcclxuICAgIHZpZGVvLnZvbHVtZSA9IGN1cnJlbnRWb2x1bWU7XHJcbiAgICBwbGF5ZXJWb2x1bWVDaXJsY2Uuc3R5bGUubGVmdCA9IGAke2N1cnJlbnRWb2x1bWUgKiAxMDB9JWA7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGN1cnJlbnRWb2x1bWUgPSB2aWRlby52b2x1bWU7XHJcbiAgICAgICAgdmlkZW8udm9sdW1lID0gc3RhcnRWb2x1bWU7XHJcbiAgICAgICAgcGxheWVyVm9sdW1lQ2lybGNlLnN0eWxlLmxlZnQgPSBgJHtzdGFydFZvbHVtZX0lYDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBtdXRlZCB2aWRlb1xyXG5cclxuICAgIC8vLyB1bm11dGVkIHZpZGVvXHJcbiAgICBcclxuICAgIFxyXG59XHJcblxyXG5wbGF5ZXJWb2x1bWVCYXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjaGFuZ2VWb2x1bWUpO1xyXG5wbGF5ZXJWb2x1bWVJY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlU291bmQpO1xyXG5cclxuY29uc3QgaGFuZGxlRHVyYXRpb24gPSAoZSkgPT4ge1xyXG4gICAgY29uc3QgYmFyU2l6ZSA9IHBhcnNlSW50KGdldENvbXB1dGVkU3R5bGUocGxheWVyUGxheWJhY2spLndpZHRoKTtcclxuICAgIGNvbnN0IGNpcmxjZVdpZHRoID0gcGFyc2VJbnQoZ2V0Q29tcHV0ZWRTdHlsZShwbGF5ZXJWaWRlb0NpcmNsZSkud2lkdGgpO1xyXG4gICAgLy8gY29uc3Qge29mZnNldFh9ID0gZTtcclxuICAgIGNvbnN0IG9mZnNldFggPSBlLm9mZnNldFg7XHJcbiAgICBjb25zdCBuZXdTaXplID0gb2Zmc2V0WCArIGNpcmxjZVdpZHRoIC8gMjtcclxuICAgIGNvbnN0IG5ld1RpbWUgPSAobmV3U2l6ZSAqIHZpZGVvLmR1cmF0aW9uKSAvIGJhclNpemU7XHJcbiAgICB2aWRlby5jdXJyZW50VGltZSA9IG5ld1RpbWU7XHJcbn1cclxuXHJcbmNvbnN0IHVwZGF0ZVRpbWUgPSAoKSA9PiB7XHJcbiAgICBsZXQgb3JhbmdlQmFyID0gdmlkZW8uY3VycmVudFRpbWUgLyB2aWRlby5kdXJhdGlvbjtcclxuICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gYCR7b3JhbmdlQmFyICogMTAwfSVgO1xyXG5cclxuICAgIGlmICh2aWRlby5lbmRlZCkge1xyXG4gICAgICAgIHZpZGVvLmN1cnJlbnRUaW1lID0gMDtcclxuICAgIH1cclxufVxyXG5cclxucGxheWVyUGxheWJhY2suYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVEdXJhdGlvbik7XHJcbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ3RpbWV1cGRhdGUnLCB1cGRhdGVUaW1lKTtcclxufSkgKCk7IiwiKGZ1bmN0aW9uKCkge1xyXG5jb25zdCBzbGlkZXIgPSAkKCcuc2xpZGVyX19saXN0JykuYnhTbGlkZXIoe1xyXG4gICAgcGFnZXI6IGZhbHNlLFxyXG4gICAgY29udHJvbHM6IGZhbHNlLFxyXG4gICAgc3BlZWQ6IDc1MCxcclxuICAgIGVhc2luZzogJ2Vhc2UtaW4tb3V0J1xyXG59KTtcclxuXHJcbiQoJy5zbGlkZXJfX2Fycm93LS1sZWZ0JykuY2xpY2soZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBzbGlkZXIuZ29Ub1ByZXZTbGlkZSgpO1xyXG59KVxyXG5cclxuJCgnLnNsaWRlcl9fYXJyb3ctLXJpZ2h0JykuY2xpY2soZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBzbGlkZXIuZ29Ub05leHRTbGlkZSgpXHJcbn0pO1xyXG59KSAoKTsiLCIoZnVuY3Rpb24oKSB7XHJcbmNvbnN0IGZpbmRCbG9ja0J5QWxpYXMgPSAoYWxpYXMpID0+IHtcclxuICAgIHJldHVybiAkKCcucmV2aWV3X19pdGVtJykuZmlsdGVyKChuZHgsIGl0ZW0pID0+IHtcclxuICAgICAgICByZXR1cm4gJChpdGVtKS5hdHRyKCdkYXRhLWxpbmtlZC13aXRoJykgPT0gYWxpYXM7XHJcbiAgICB9KTtcclxufVxyXG4kKCcuaW50ZXJhY3RpdmUtYXZhdGFyX19saW5rJykuY2xpY2soZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBcclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cignZGF0YS1vcGVuJyk7XHJcbiAgICBjb25zdCBpdGVtVG9TaG93ID0gZmluZEJsb2NrQnlBbGlhcyh0YXJnZXQpO1xyXG4gICAgY29uc3QgY3VySXRlbSA9ICR0aGlzLmNsb3Nlc3QoJy5yZXZpZXdlcnNfX2l0ZW0nKTtcclxuXHJcbiAgICBpdGVtVG9TaG93LmFkZENsYXNzKCdhY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgIGN1ckl0ZW0uYWRkQ2xhc3MoXCJyZXZpZXdlcnNfX2l0ZW0tLWFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdyZXZpZXdlcnNfX2l0ZW0tLWFjdGl2ZScpO1xyXG59KVxyXG59KSAoKTsiXX0=
